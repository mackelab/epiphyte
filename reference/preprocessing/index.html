
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../data/">
      
      
        <link rel="next" href="../../contribute/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Preprocessing - Epiphyte</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#epiphyte.preprocessing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Epiphyte" class="md-header__button md-logo" aria-label="Epiphyte" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Epiphyte
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Preprocessing
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Epiphyte" class="md-nav__button md-logo" aria-label="Epiphyte" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Epiphyte
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/Launch%20the%20MySQL%20database%20locally/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Launch the MySQL database locally
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/1.%20Launch%20the%20MySQL%20database%20on%20a%20virtual%20machine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Launch the MySQL database on a virtual machine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/2.%20%28Optional%29%20Add%20MinIO%20to%20an%20existing%20virtual%20machine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Add MinIO to an existing VM (optional)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/3.%20Install%20Epiphyte/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install Epiphyte
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/4.%20Configure%20and%20connect%20to%20the%20database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configure and connect to the database
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/5.%20Design%20and%20implement%20the%20database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Design and implement the database
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/6.%20Compile%20the%20codebase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compile the codebase
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/7.%20%28Optional%29%20Run%20regular%20backups/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Run regular backups (optional)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/8_Add_new_table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Add a table to an existing database
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Database
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data utilities
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Preprocessing
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Preprocessing
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.annotation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;annotation
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" annotation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.annotation.data_driven_annotation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;data_driven_annotation
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" data_driven_annotation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.annotation.data_driven_annotation.cpt" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;cpt
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;stimulus_driven_annotation
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" stimulus_driven_annotation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;movies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;data_preprocessing
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" data_preprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.binning" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;binning
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" binning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.binning.bin_label" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;bin_label
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.binning.bin_spikes" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;bin_spikes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;create_vectors_from_time_points
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" create_vectors_from_time_points">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_index_nearest_timestamp_in_vector" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_index_nearest_timestamp_in_vector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_nearest_value_from_vector" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_nearest_value_from_vector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.create_vector_from_start_stop_times_reference_cont_watch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_vector_from_start_stop_times_reference_cont_watch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.create_vector_from_start_stop_times" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_vector_from_start_stop_times
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_start_stop_times_from_label" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_start_stop_times_from_label
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_bins_excl_pauses" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_bins_excl_pauses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.create_vector_from_start_stop_times_reference" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_vector_from_start_stop_times_reference
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_value_matching_start_point" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_value_matching_start_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_value_matching_stop_point" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_value_matching_stop_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_index_matching_start_point" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_index_matching_start_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_index_matching_stop_point" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_index_matching_stop_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_value_in_time_frame" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_value_in_time_frame
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;data_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" data_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.TimeConversion" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TimeConversion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.nev_read" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;nev_read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.nev_string_read" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;nev_string_read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.process_movie_events" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;process_movie_events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.process_events" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;process_events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.getlines" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;getlines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.read_watchlog" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;read_watchlog
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.read_watchlog_pauses" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;read_watchlog_pauses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.read_daqlog" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;read_daqlog
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.get_coeff" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_coeff
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.make_msec" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;make_msec
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Community
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Community
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contribute/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../acknowledgements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Acknowledgements
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.annotation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;annotation
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" annotation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.annotation.data_driven_annotation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;data_driven_annotation
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" data_driven_annotation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.annotation.data_driven_annotation.cpt" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;cpt
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;stimulus_driven_annotation
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" stimulus_driven_annotation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;movies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;data_preprocessing
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" data_preprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.binning" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;binning
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" binning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.binning.bin_label" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;bin_label
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.binning.bin_spikes" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;bin_spikes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;create_vectors_from_time_points
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" create_vectors_from_time_points">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_index_nearest_timestamp_in_vector" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_index_nearest_timestamp_in_vector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_nearest_value_from_vector" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_nearest_value_from_vector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.create_vector_from_start_stop_times_reference_cont_watch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_vector_from_start_stop_times_reference_cont_watch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.create_vector_from_start_stop_times" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_vector_from_start_stop_times
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_start_stop_times_from_label" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_start_stop_times_from_label
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_bins_excl_pauses" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_bins_excl_pauses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.create_vector_from_start_stop_times_reference" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_vector_from_start_stop_times_reference
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_value_matching_start_point" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_value_matching_start_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_value_matching_stop_point" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_value_matching_stop_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_index_matching_start_point" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_index_matching_start_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_index_matching_stop_point" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_index_matching_stop_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_value_in_time_frame" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_value_in_time_frame
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;data_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" data_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.TimeConversion" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TimeConversion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.nev_read" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;nev_read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.nev_string_read" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;nev_string_read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.process_movie_events" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;process_movie_events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.process_events" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;process_events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.getlines" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;getlines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.read_watchlog" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;read_watchlog
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.read_watchlog_pauses" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;read_watchlog_pauses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.read_daqlog" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;read_daqlog
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.get_coeff" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_coeff
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#epiphyte.preprocessing.data_preprocessing.data_utils.make_msec" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;make_msec
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div class="doc doc-object doc-module">



<h1 id="epiphyte.preprocessing" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">epiphyte.preprocessing</span>


<a href="#epiphyte.preprocessing" class="headerlink" title="Permanent link">&para;</a></h1>

    <div class="doc doc-contents first">










  <div class="doc doc-children">











<div class="doc doc-object doc-module">



<h2 id="epiphyte.preprocessing.annotation" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">annotation</span>


<a href="#epiphyte.preprocessing.annotation" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">










  <div class="doc doc-children">











<div class="doc doc-object doc-module">



<h3 id="epiphyte.preprocessing.annotation.data_driven_annotation" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">data_driven_annotation</span>


<a href="#epiphyte.preprocessing.annotation.data_driven_annotation" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">











<div class="doc doc-object doc-module">



<h4 id="epiphyte.preprocessing.annotation.data_driven_annotation.cpt" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">cpt</span>


<a href="#epiphyte.preprocessing.annotation.data_driven_annotation.cpt" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Detects the changepoint in a spike train using parametric statistic testing.</p>
<p>Plots the results and returns the index of the breakpoint and the stat test results.</p>
<p>Used for demonstrating the addition of a new table to an existing database.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="epiphyte.preprocessing.annotation.data_driven_annotation.cpt.find_changepoint_tt" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">find_changepoint_tt</span>


<a href="#epiphyte.preprocessing.annotation.data_driven_annotation.cpt.find_changepoint_tt" class="headerlink" title="Permanent link">&para;</a></h5>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">find_changepoint_tt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Detects the changepoint in a spike train using parametric statistic testing.
Plots the results and returns the index of the breakpoint and the stat test results.</p>
<p>Accepts and runs one unit. Set up to be iterated over for the whole of a dataset of units.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>spike train data (1D array-like)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, prints detailed changepoint and t-test results</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>taustar</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>index of the determined breakpoint.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>ttest</code></td>            <td>
                  <code><span title="scipy.stats.ttest_ind_from_stats">ttest_ind_from_stats</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>results from the scipy stats ttest (type is a specific class construction from scipy)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/data_driven_annotation/cpt.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_changepoint_tt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detects the changepoint in a spike train using parametric statistic testing.</span>
<span class="sd">    Plots the results and returns the index of the breakpoint and the stat test results.</span>

<span class="sd">    Accepts and runs one unit. Set up to be iterated over for the whole of a dataset of units.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (np.ndarray):  spike train data (1D array-like)</span>
<span class="sd">        verbose (bool):    if True, prints detailed changepoint and t-test results</span>

<span class="sd">    Returns:</span>
<span class="sd">        taustar (int): index of the determined breakpoint.</span>
<span class="sd">        ttest (stats.ttest_ind_from_stats): results from the scipy stats ttest (type is a specific class construction from scipy)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">mu0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># global mean</span>
    <span class="n">s0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">data</span> <span class="o">-</span> <span class="n">mu0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># squared difference from global mean</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)])</span>  <span class="c1"># squared sum before changepoint</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:]))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)])</span>  <span class="c1"># squared sum after changepoint</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">-</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">s2</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>

    <span class="n">taustar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">R</span> <span class="o">==</span> <span class="n">G</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">taustar</span><span class="p">])</span>
    <span class="n">std1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">taustar</span><span class="p">])</span>
    <span class="n">nobs1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">taustar</span><span class="p">])</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">taustar</span><span class="p">:])</span>
    <span class="n">std2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">taustar</span><span class="p">:])</span>
    <span class="n">nobs2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">taustar</span><span class="p">:])</span>

    <span class="n">ttest</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind_from_stats</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">std1</span><span class="p">,</span> <span class="n">nobs1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">std2</span><span class="p">,</span> <span class="n">nobs2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Changepoint results:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tau*: &quot;</span><span class="p">,</span> <span class="n">taustar</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mean pre-tau: &quot;</span><span class="p">,</span> <span class="n">m1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;std  pre-tau: &quot;</span><span class="p">,</span> <span class="n">std1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mean post-tau: &quot;</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;std  post-tau:&quot;</span><span class="p">,</span> <span class="n">std2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;T-test results:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ttest</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">taustar</span><span class="p">,</span> <span class="n">ttest</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="epiphyte.preprocessing.annotation.data_driven_annotation.cpt.plot_changepoint" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">plot_changepoint</span>


<a href="#epiphyte.preprocessing.annotation.data_driven_annotation.cpt.plot_changepoint" class="headerlink" title="Permanent link">&para;</a></h5>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">plot_changepoint</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">taustar</span><span class="p">,</span> <span class="n">ttest</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comparison_tau</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Plot a change point in neural activity data and annotate with statistical results.</p>
<p>This function visualizes time-binned neural activity and overlays vertical
lines indicating the detected change point (<code>taustar</code>) and, optionally, a
second change point (<code>comparison_tau</code>). It also displays the results of a
t-test as legend entries.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="array">array</span> - <span title="like">like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence of neural activity values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>taustar</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Detected change point index (in 1-second bins).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ttest</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing (t-statistic, p-value) from a t-test.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory path where plots should be saved. If None, plots are not saved.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base filename (without extension) for saving plots. Required if <code>save</code> is provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>comparison_tau</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Another change point index to compare with <code>taustar</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="saves" open>
  <summary>Saves</summary>
  <ul>
<li><code>{filename}_cpt.png</code> in the <code>save</code> directory if <code>save</code> is provided.</li>
<li><code>{filename}_cpt.svg</code> in the <code>save</code> directory if <code>save</code> is provided.</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">ttest_ind</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
<span class="n">ttest</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>
<span class="n">plot_changepoint</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">taustar</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ttest</span><span class="o">=</span><span class="n">ttest</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;plots/&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;session1&quot;</span><span class="p">)</span>
</code></pre></div>
</details>

            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/data_driven_annotation/cpt.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_changepoint</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">taustar</span><span class="p">,</span> <span class="n">ttest</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comparison_tau</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a change point in neural activity data and annotate with statistical results.</span>

<span class="sd">    This function visualizes time-binned neural activity and overlays vertical</span>
<span class="sd">    lines indicating the detected change point (`taustar`) and, optionally, a</span>
<span class="sd">    second change point (`comparison_tau`). It also displays the results of a</span>
<span class="sd">    t-test as legend entries.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (array-like): </span>
<span class="sd">            Sequence of neural activity values.</span>
<span class="sd">        taustar (int): </span>
<span class="sd">            Detected change point index (in 1-second bins).</span>
<span class="sd">        ttest (tuple): </span>
<span class="sd">            A tuple containing (t-statistic, p-value) from a t-test.</span>
<span class="sd">        save (str, optional): </span>
<span class="sd">            Directory path where plots should be saved. If None, plots are not saved.</span>
<span class="sd">        filename (str, optional): </span>
<span class="sd">            Base filename (without extension) for saving plots. Required if `save` is provided.</span>
<span class="sd">        comparison_tau (int, optional): </span>
<span class="sd">            Another change point index to compare with `taustar`.</span>

<span class="sd">    Saves:</span>
<span class="sd">        - `{filename}_cpt.png` in the `save` directory if `save` is provided.</span>
<span class="sd">        - `{filename}_cpt.svg` in the `save` directory if `save` is provided.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        from scipy.stats import ttest_ind</span>

<span class="sd">        data = [0, 1, 2, 5, 6, 7, 10, 11]</span>
<span class="sd">        ttest = ttest_ind(data[:4], data[4:])</span>
<span class="sd">        plot_changepoint(data, taustar=4, ttest=ttest, save=&quot;plots/&quot;, filename=&quot;session1&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">taustar</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;tau: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">taustar</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">comparison_tau</span><span class="p">:</span>
        <span class="c1"># note: comparison_tau is expected to be an int type value from a previously computed set of cpt results</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">comparison_tau</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;other tau: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comparison_tau</span><span class="p">))</span>

    <span class="n">pval_str</span> <span class="o">=</span> <span class="s2">&quot;P-value: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">tstat_str</span> <span class="o">=</span> <span class="s2">&quot;T-statistic: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">pval_str</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">tstat_str</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [1 sec bins]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Neural Activity [spikes / bin]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39; change point statistics&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_cpt.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_cpt.svg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">stimulus_driven_annotation</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">











<div class="doc doc-object doc-module">



<h4 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">movies</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">











<div class="doc doc-object doc-module">



<h5 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.annotation_utils" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">annotation_utils</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.annotation_utils" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

        <p>Helpers for handling stimulus-driven annotations in an analysis workflows.</p>
<p>Provides utilities to split neural activity by label values for downstream
analysis and visualization.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.annotation_utils.split_activity_by_value" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">split_activity_by_value</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.annotation_utils.split_activity_by_value" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">split_activity_by_value</span><span class="p">(</span><span class="n">binned_activity</span><span class="p">,</span> <span class="n">binned_label</span><span class="p">,</span> <span class="n">specific_values</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Split binned activity by the values in a binned label vector.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>For a binary label (stimulus on/off), the <code>binned_label</code> vector
contains 0/1. This function returns two arrays mapping to segments
where the label is off/on, respectively. For multi-valued labels,
activity is split per unique value.</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>binned_activity</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binned neural activity (shape <code>(N, ...)</code>).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>binned_label</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binned label aligned to the activity (length <code>N</code>).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>specific_values</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Iterable">Iterable</span>[<span title="int">int</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided, only these label values are used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, np.ndarray]: Mapping <code>{value_name: activity_subset}</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/annotation_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">split_activity_by_value</span><span class="p">(</span>
    <span class="n">binned_activity</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">binned_label</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">specific_values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split binned activity by the values in a binned label vector.</span>

<span class="sd">    Example:</span>
<span class="sd">        For a binary label (stimulus on/off), the ``binned_label`` vector</span>
<span class="sd">        contains 0/1. This function returns two arrays mapping to segments</span>
<span class="sd">        where the label is off/on, respectively. For multi-valued labels,</span>
<span class="sd">        activity is split per unique value.</span>

<span class="sd">    Args:</span>
<span class="sd">        binned_activity (np.ndarray): Binned neural activity (shape ``(N, ...)``).</span>
<span class="sd">        binned_label (np.ndarray): Binned label aligned to the activity (length ``N``).</span>
<span class="sd">        specific_values (Optional[Iterable[int]]): If provided, only these label values are used.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict[str, np.ndarray]: Mapping ``{value_name: activity_subset}``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set up for number --&gt; word converstion </span>
    <span class="n">alph</span> <span class="o">=</span> <span class="n">inflect</span><span class="o">.</span><span class="n">engine</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">specific_values</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">binned_label</span><span class="p">)</span>

        <span class="n">ret_vectors</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>

            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">binned_label</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">activity_from_val</span> <span class="o">=</span> <span class="n">binned_activity</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>

            <span class="c1"># Convert value number to the word, for easy referencing during analysis</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">alph</span><span class="o">.</span><span class="n">number_to_words</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

            <span class="n">ret_vectors</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">activity_from_val</span>

    <span class="k">if</span> <span class="n">specific_values</span><span class="p">:</span>

        <span class="n">ret_vectors</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">specific_values</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">binned_label</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">activity_from_val</span> <span class="o">=</span> <span class="n">binned_activity</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">alph</span><span class="o">.</span><span class="n">number_to_words</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="n">ret_vectors</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">activity_from_val</span>

    <span class="k">return</span> <span class="n">ret_vectors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h5 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.pause_handling" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">pause_handling</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.pause_handling" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

        <p>Helpers to handle pause intervals while binning labels and spikes.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.pause_handling.pause_start_bin" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">pause_start_bin</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.pause_handling.pause_start_bin" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">pause_start_bin</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Find start bin index inclusive of the pause start.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> or <span title="list">list</span> - <span title="like">like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bin edges (ms).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pause start time (ms).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    int: index of the start bin.</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/pause_handling.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pause_start_bin</span><span class="p">(</span><span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find start bin index inclusive of the pause start.</span>

<span class="sd">    Args:</span>
<span class="sd">        bins (np.ndarray or list-like): bin edges (ms).</span>
<span class="sd">        start (float): Pause start time (ms).</span>
<span class="sd">    Returns:</span>
<span class="sd">        int: index of the start bin.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ind_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bins</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>  
    <span class="k">if</span> <span class="n">bins</span><span class="p">[</span><span class="n">ind_start</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">:</span> 
        <span class="n">start_bin</span> <span class="o">=</span> <span class="n">ind_start</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">start_bin</span> <span class="o">=</span> <span class="n">ind_start</span>
    <span class="k">return</span> <span class="n">start_bin</span> 
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.pause_handling.pause_stop_bin" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">pause_stop_bin</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.pause_handling.pause_stop_bin" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">pause_stop_bin</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Find stop bin index inclusive of the pause stop.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bin edges (ms).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stop</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pause stop time (ms).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    int: Index of the stop bin.</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/pause_handling.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pause_stop_bin</span><span class="p">(</span><span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find stop bin index inclusive of the pause stop.</span>

<span class="sd">    Args:</span>
<span class="sd">        bins: Bin edges (ms).</span>
<span class="sd">        stop: Pause stop time (ms).</span>
<span class="sd">    Returns:</span>
<span class="sd">        int: Index of the stop bin.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ind_stop</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bins</span> <span class="o">-</span> <span class="n">stop</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">bins</span><span class="p">[</span><span class="n">ind_stop</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
        <span class="n">stop_bin</span> <span class="o">=</span> <span class="n">ind_stop</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stop_bin</span> <span class="o">=</span> <span class="n">ind_stop</span>
    <span class="k">return</span> <span class="n">stop_bin</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.pause_handling.make_pause_interval" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">make_pause_interval</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.pause_handling.make_pause_interval" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">make_pause_interval</span><span class="p">(</span><span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Make a list of indices spanning the pause interval (inclusive).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bin_start</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start bin index.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bin_stop</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stop bin index.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    List[int]: List of indices spanning the pause interval (inclusive).</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/pause_handling.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_pause_interval</span><span class="p">(</span><span class="n">bin_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a list of indices spanning the pause interval (inclusive).</span>

<span class="sd">    Args:</span>
<span class="sd">        bin_start (int): Start bin index.</span>
<span class="sd">        bin_stop (int): Stop bin index.</span>
<span class="sd">    Returns:</span>
<span class="sd">        List[int]: List of indices spanning the pause interval (inclusive).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pause</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">bin_start</span><span class="p">,</span> <span class="p">(</span><span class="n">bin_stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pause</span> 
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.pause_handling.rm_pauses_bins" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">rm_pauses_bins</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.pause_handling.rm_pauses_bins" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">rm_pauses_bins</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">return_intervals</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Remove bin edges that occur during paused playback.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> or <span title="list">list</span> - <span title="like">like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bin edges (ms).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> or <span title="list">list</span> - <span title="like">like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pause starts (ms).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stop</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> or <span title="list">list</span> - <span title="like">like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pause stops (ms).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_intervals</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, also return indices removed.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns: 
    Tuple[np.ndarray, List[int]]: Cleaned bins or <code>(bins_no_pauses, removed_indices)</code>.</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/pause_handling.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rm_pauses_bins</span><span class="p">(</span>
    <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">stop</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">return_intervals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove bin edges that occur during paused playback.</span>

<span class="sd">    Args:</span>
<span class="sd">        bins (np.ndarray or list-like): Bin edges (ms).</span>
<span class="sd">        start (np.ndarray or list-like): Pause starts (ms).</span>
<span class="sd">        stop (np.ndarray or list-like): Pause stops (ms).</span>
<span class="sd">        return_intervals (bool): If ``True``, also return indices removed.</span>
<span class="sd">    Returns: </span>
<span class="sd">        Tuple[np.ndarray, List[int]]: Cleaned bins or ``(bins_no_pauses, removed_indices)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pauses</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)):</span>
        <span class="n">start_bin</span> <span class="o">=</span> <span class="n">pause_start_bin</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">start</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">stop_bin</span>  <span class="o">=</span> <span class="n">pause_stop_bin</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">stop</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="n">make_pause_interval</span><span class="p">(</span><span class="n">start_bin</span><span class="p">,</span> <span class="n">stop_bin</span><span class="p">)</span>
        <span class="n">pauses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>

    <span class="n">flatten</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
    <span class="n">all_pauses</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">pauses</span><span class="p">)</span>

    <span class="n">no_pauses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">all_pauses</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_intervals</span><span class="p">:</span> 
        <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="n">no_pauses</span><span class="p">,</span> <span class="n">all_pauses</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">no_pauses</span>

    <span class="k">return</span> <span class="n">output</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.pause_handling.rm_pauses_spikes" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">rm_pauses_spikes</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.pause_handling.rm_pauses_spikes" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">rm_pauses_spikes</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">return_intervals</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Remove spikes that occur during paused playback.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>unit</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spike times (ms).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pause starts (ms).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stop</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pause stops (ms).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_intervals</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, also return removed indices.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns: 
    Tuple[np.ndarray, List[int]]: Cleaned spikes or <code>(unit_no_pauses, removed_indices)</code>.</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/pause_handling.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rm_pauses_spikes</span><span class="p">(</span>
    <span class="n">unit</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">stop</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">return_intervals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove spikes that occur during paused playback.</span>

<span class="sd">    Args:</span>
<span class="sd">        unit (np.ndarray): Spike times (ms).</span>
<span class="sd">        start (np.ndarray): Pause starts (ms).</span>
<span class="sd">        stop (np.ndarray): Pause stops (ms).</span>
<span class="sd">        return_intervals (bool): If ``True``, also return removed indices.</span>
<span class="sd">    Returns: </span>
<span class="sd">        Tuple[np.ndarray, List[int]]: Cleaned spikes or ``(unit_no_pauses, removed_indices)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">paused_spikes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unit</span><span class="p">):</span> 
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">spk</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">spk</span> <span class="o">&lt;=</span> <span class="n">stop</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">paused_spikes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="n">unit_no_pauses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">paused_spikes</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_intervals</span><span class="p">:</span> 
        <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="n">unit_no_pauses</span><span class="p">,</span> <span class="n">paused_spikes</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">unit_no_pauses</span>

    <span class="k">return</span> <span class="n">output</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h5 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.processing_labels" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">processing_labels</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.processing_labels" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.processing_labels.make_label_from_start_stop_times" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">make_label_from_start_stop_times</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.processing_labels.make_label_from_start_stop_times" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">make_label_from_start_stop_times</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">start_times</span><span class="p">,</span> <span class="n">stop_times</span><span class="p">,</span> <span class="n">ref_vec</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This function takes a vector with tuples with start and stop times and converts it to the default label</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ref_vec</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>reference vector, e.g. either PTS of movie or neural recording time of patient</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_value</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>default value of label, which shall be added to all gaps in start stop times</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_times</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all start_times of segments</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stop_times</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all stop times of segments</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    list[int] | int: Label vector, or <code>-1</code> on error.</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/processing_labels.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_label_from_start_stop_times</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">start_times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">stop_times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">ref_vec</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">default_value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function takes a vector with tuples with start and stop times and converts it to the default label</span>

<span class="sd">    Args:</span>
<span class="sd">        ref_vec (np.ndarray): reference vector, e.g. either PTS of movie or neural recording time of patient</span>
<span class="sd">        default_value (int): default value of label, which shall be added to all gaps in start stop times</span>
<span class="sd">        values (list): vector with all values</span>
<span class="sd">        start_times (list): vector with all start_times of segments</span>
<span class="sd">        stop_times (list): vector with all stop times of segments</span>
<span class="sd">    Returns:</span>
<span class="sd">        list[int] | int: Label vector, or ``-1`` on error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">start_times</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">stop_times</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;vectors values, starts and stops have to be the same length&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">default_label</span> <span class="o">=</span> <span class="p">[</span><span class="n">default_value</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ref_vec</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
        <span class="n">start_index_in_default_vec</span> <span class="o">=</span> <span class="n">create_vectors_from_time_points</span><span class="o">.</span><span class="n">get_index_nearest_timestamp_in_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ref_vec</span><span class="p">),</span> <span class="n">start_times</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">end_index_in_default_vec</span> <span class="o">=</span> <span class="n">create_vectors_from_time_points</span><span class="o">.</span><span class="n">get_index_nearest_timestamp_in_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ref_vec</span><span class="p">),</span> <span class="n">stop_times</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">default_label</span><span class="p">[</span><span class="n">start_index_in_default_vec</span><span class="p">:(</span><span class="n">end_index_in_default_vec</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> \
            <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span><span class="o">*</span><span class="p">(</span><span class="n">end_index_in_default_vec</span> <span class="o">-</span> <span class="n">start_index_in_default_vec</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">default_label</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.processing_labels.create_xml_for_advene" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">create_xml_for_advene</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.processing_labels.create_xml_for_advene" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">create_xml_for_advene</span><span class="p">(</span><span class="n">id_name</span><span class="p">,</span> <span class="n">start_end_times_vector</span><span class="p">,</span> <span class="n">label_name</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This function creates an XML string, which can be imported to the movie annotation tool Advene</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>id_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of ID in XML file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_end_times_vector</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>input vector that contains the start and end times of the label in milliseconds</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>label_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the label how it shall be displayed in the GUI of Advene</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an XML string that can be copied to the content.xml file and loaded to Advene</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/processing_labels.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_xml_for_advene</span><span class="p">(</span><span class="n">id_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_end_times_vector</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">label_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function creates an XML string, which can be imported to the movie annotation tool Advene</span>

<span class="sd">    Args:</span>
<span class="sd">        id_name (str): name of ID in XML file</span>
<span class="sd">        start_end_times_vector (list): input vector that contains the start and end times of the label in milliseconds</span>
<span class="sd">        label_name (str): the name of the label how it shall be displayed in the GUI of Advene</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: an XML string that can be copied to the content.xml file and loaded to Advene</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_annotations</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">id_</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">start_end_times_vector</span><span class="p">:</span>
        <span class="n">string_new_annotation</span> <span class="o">=</span> <span class="s1">&#39;&lt;annotation id=&quot;</span><span class="si">{}{}</span><span class="s1">&quot; type=&quot;#</span><span class="si">{}</span><span class="s1">&quot;&gt;&lt;millisecond-fragment begin=&quot;</span><span class="si">{}</span><span class="s1">&quot; end=&quot;</span><span class="si">{}</span><span class="s1">&quot;/&gt;&lt;content&gt;num=1&lt;/content&gt;&lt;/annotation&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">id_name</span><span class="p">,</span> <span class="n">id_</span><span class="p">,</span> <span class="n">label_name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

        <span class="n">new_annotations</span> <span class="o">+=</span> <span class="n">string_new_annotation</span>

        <span class="n">id_</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">new_annotations</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.processing_labels.start_stop_values_from_json" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">start_stop_values_from_json</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.processing_labels.start_stop_values_from_json" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">start_stop_values_from_json</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="n">label_name</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This function extracts start times, stop times and values of all segments of a label from a json file</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_to_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to json file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>label_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of label (how it was specified in json file)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    np.ndarray, np.ndarray, np.ndarray: first array: values of label, second array: start times of label segments in seconds, third array: stop times of label segments in seconds</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/processing_labels.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">start_stop_values_from_json</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts start times, stop times and values of all segments of a label from a json file</span>

<span class="sd">    Args:</span>
<span class="sd">        path_to_file (str): path to json file</span>
<span class="sd">        label_name (str): name of label (how it was specified in json file)</span>
<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray, np.ndarray, np.ndarray: first array: values of label, second array: start times of label segments in seconds, third array: stop times of label segments in seconds</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># open and read json file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonfile</span><span class="p">:</span>
        <span class="n">labels_json_file</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">jsonfile</span><span class="p">)</span> 

    <span class="n">start_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stop_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># iterate through elements in json file to extract time points of segments</span>
    <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">labels_json_file</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">label_name</span><span class="p">:</span>
            <span class="n">start_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;begin&quot;</span><span class="p">))</span>
            <span class="n">stop_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">))</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">start_times</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stop_times</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.processing_labels.export_labels_from_json_file" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">export_labels_from_json_file</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.processing_labels.export_labels_from_json_file" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">export_labels_from_json_file</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="n">label_name</span><span class="p">,</span> <span class="n">bool_save_start_end_times</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Process a json file from Advene and create a new label.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_to_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to json file containing all information about the labels from Advene</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>label_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name that was specified in Advene</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bool_save_start_end_times</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>determine whether the start and end times should be saved as a npy file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    list: new label, aligned with movie (default label)</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/processing_labels.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">export_labels_from_json_file</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bool_save_start_end_times</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process a json file from Advene and create a new label.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_to_file (str): path to json file containing all information about the labels from Advene</span>
<span class="sd">        label_name (str): name that was specified in Advene</span>
<span class="sd">        bool_save_start_end_times (bool): determine whether the start and end times should be saved as a npy file</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: new label, aligned with movie (default label)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonfile</span><span class="p">:</span>
        <span class="n">labels_json_file</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">jsonfile</span><span class="p">)</span>

    <span class="n">label_start_end_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">labels_json_file</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">label_name</span><span class="p">:</span>
            <span class="n">label_start_end_times</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;begin&quot;</span><span class="p">),</span> <span class="n">annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">)])</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">))</span>

    <span class="c1"># if requested, the start and end times will be saved</span>
    <span class="k">if</span> <span class="n">bool_save_start_end_times</span><span class="p">:</span>
        <span class="n">start_end_times_seconds</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">y</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">]</span> <span class="k">for</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="ow">in</span> <span class="n">label_start_end_times</span><span class="p">]</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;../useful_data/start_end_times/start_end_times_</span><span class="si">{}</span><span class="s2">.npy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label_name</span><span class="p">),</span> <span class="n">start_end_times_seconds</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">label_start_end_times</span><span class="p">,</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.processing_labels.get_start_stop_times_from_label" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_start_stop_times_from_label</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.processing_labels.get_start_stop_times_from_label" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_start_stop_times_from_label</span><span class="p">(</span><span class="n">neural_rec_time</span><span class="p">,</span> <span class="n">patient_aligned_label</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This function takes the patient aligned label and extracts the start and stop times from that.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>neural_rec_time</code>
            </td>
            <td>
                  <code><span title="array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>neural recording time of patient</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patient_aligned_label</code>
            </td>
            <td>
                  <code><span title="array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>patient aligned label</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    values (list), start times (list) and stop times (list) of label segments</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/processing_labels.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_start_stop_times_from_label</span><span class="p">(</span><span class="n">neural_rec_time</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">patient_aligned_label</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function takes the patient aligned label and extracts the start and stop times from that.</span>

<span class="sd">    Args:</span>
<span class="sd">        neural_rec_time (array): neural recording time of patient</span>
<span class="sd">        patient_aligned_label (array): patient aligned label</span>
<span class="sd">    Returns:</span>
<span class="sd">        values (list), start times (list) and stop times (list) of label segments</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="n">patient_aligned_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp</span><span class="p">]</span>
    <span class="n">start_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">neural_rec_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">stop_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">patient_aligned_label</span><span class="p">)):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">patient_aligned_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">tmp</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patient_aligned_label</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">start_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neural_rec_time</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">stop_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neural_rec_time</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">patient_aligned_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">stop_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neural_rec_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">values</span><span class="p">,</span> <span class="n">start_times</span><span class="p">,</span> <span class="n">stop_times</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h5 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">watch_log</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

        <p>Watch log parsing utilities for extracting PTS and CPU timestamps.</p>
<p>This module provides the :class:<code>WatchLog</code> class to read a "watch log" file,
derive start/end times, and build aligned arrays/dataframes of presentation
timestamps (PTS) and real (CPU) times. It also includes helpers to trim the
recorded time series to a maximum movie duration.</p>


<details class="constants" open>
  <summary>Constants</summary>
  <p>MAX_MOVIE_TIME (int): Maximum allowable movie time (in the same units as PTS)
    used to filter out timestamps beyond the movie length.</p>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>wl = WatchLog("/path/to/watch.log")
wl.get_start_time(), wl.get_end_time()
(12, 5012)
wl.df_pts_cpu.head()</p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log--pts-cpu_time">pts  cpu_time<a class="headerlink" href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log--pts-cpu_time" title="Permanent link">&para;</a></h6>
<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log--0-000-1234">0  0.00      1234<a class="headerlink" href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log--0-000-1234" title="Permanent link">&para;</a></h6>
<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log--1-004-1270">1  0.04      1270<a class="headerlink" href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log--1-004-1270" title="Permanent link">&para;</a></h6>
</details>









  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h6 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">WatchLog</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">


        <p>Parse a watch log file and process the concurrent presentation time stamps (PTS) and the local PC (CPU) time series.</p>
<p>On initialization, this class:
  1) Reads the provided watch log file.
  2) Extracts the start and end CPU timestamps.
  3) Loads all PTS/CPU rows, trims them to the maximum movie length, and
     converts CPU timestamps to seconds (integer, via floor division by 1000).
  4) Builds a pandas DataFrame (:attr:<code>df_pts_cpu</code>) with <code>pts</code> and <code>cpu_time</code>.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.watch_log_file">watch_log_file</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Absolute or relative path to the watch log file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.start_time">start_time</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time in seconds (CPU time derived from the file).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.end_time">end_time</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time in seconds (CPU time derived from the file).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.duration">duration</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Duration in seconds, computed as <code>end_time - start_time</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.pts_time_stamps">pts_time_stamps</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of PTS values (floats), possibly trimmed.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.dts_time_stamps">dts_time_stamps</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of CPU times in seconds (ints), possibly trimmed.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.excluded_indices">excluded_indices</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indices removed when trimming to <code>MAX_MOVIE_TIME</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.df_pts_cpu">df_pts_cpu</span></code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Two-column DataFrame with <code>pts</code> and <code>cpu_time</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The method :meth:<code>getlines</code> reads the log file in <strong>binary</strong> mode and
  returns a list of byte strings. Downstream parsing assumes whitespace-
  separated fields and converts to numeric types as needed.</li>
<li>CPU timestamps are divided by 1000 and cast to <code>int</code>, so any sub-second
  resolution is truncated rather than rounded.</li>
</ul>
</details>







              <details class="quote">
                <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/watch_log.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WatchLog</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse a watch log file and process the concurrent presentation time stamps (PTS) and the local PC (CPU) time series.</span>

<span class="sd">    On initialization, this class:</span>
<span class="sd">      1) Reads the provided watch log file.</span>
<span class="sd">      2) Extracts the start and end CPU timestamps.</span>
<span class="sd">      3) Loads all PTS/CPU rows, trims them to the maximum movie length, and</span>
<span class="sd">         converts CPU timestamps to seconds (integer, via floor division by 1000).</span>
<span class="sd">      4) Builds a pandas DataFrame (:attr:`df_pts_cpu`) with `pts` and `cpu_time`.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        watch_log_file (str): Absolute or relative path to the watch log file.</span>
<span class="sd">        start_time (int): Start time in seconds (CPU time derived from the file).</span>
<span class="sd">        end_time (int): End time in seconds (CPU time derived from the file).</span>
<span class="sd">        duration (int): Duration in seconds, computed as `end_time - start_time`.</span>
<span class="sd">        pts_time_stamps (np.ndarray): Array of PTS values (floats), possibly trimmed.</span>
<span class="sd">        dts_time_stamps (np.ndarray): Array of CPU times in seconds (ints), possibly trimmed.</span>
<span class="sd">        excluded_indices (list[int]): Indices removed when trimming to `MAX_MOVIE_TIME`.</span>
<span class="sd">        df_pts_cpu (pd.DataFrame): Two-column DataFrame with `pts` and `cpu_time`.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The method :meth:`getlines` reads the log file in **binary** mode and</span>
<span class="sd">          returns a list of byte strings. Downstream parsing assumes whitespace-</span>
<span class="sd">          separated fields and converts to numeric types as needed.</span>
<span class="sd">        - CPU timestamps are divided by 1000 and cast to `int`, so any sub-second</span>
<span class="sd">          resolution is truncated rather than rounded.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_watch_log</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the WatchLog and populate derived fields.</span>

<span class="sd">        Args:</span>
<span class="sd">            path_watch_log (str): Path to the watch log file to load.</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            - Reads the file at `path_watch_log`.</span>
<span class="sd">            - Populates attributes documented in the class docstring.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">watch_log_file</span> <span class="o">=</span> <span class="n">path_watch_log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_start_and_end_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pts_time_stamps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dts_time_stamps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_times_from_watch_log</span><span class="p">(</span><span class="n">path_watch_log</span><span class="p">)</span>
        <span class="c1"># optionally divide time stamp by 1000 to get time in seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dts_time_stamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dts_time_stamps</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_pts_cpu</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;pts&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts_time_stamps</span><span class="p">,</span> <span class="s2">&quot;cpu_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dts_time_stamps</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_pts_cpu</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;cpu_time&#39;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the start CPU time (in seconds).</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Start time in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_end_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the end CPU time (in seconds).</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: End time in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_start_time</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a new start time (in seconds).</span>

<span class="sd">        Args:</span>
<span class="sd">            new_start_time (int): The new start time in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">new_start_time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_end_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_end_time</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a new end time (in seconds).</span>

<span class="sd">        Args:</span>
<span class="sd">            new_end_time (int): The new end time in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">new_end_time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_start_and_end_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the start and end CPU timestamps from the watch log.</span>

<span class="sd">        The function reads the file in text mode, takes the second line as the</span>
<span class="sd">        &quot;first&quot; data line, and scans backward from the end to find the last line</span>
<span class="sd">        beginning with ``&quot;pts&quot;``. It returns the CPU timestamps from those two</span>
<span class="sd">        lines, converted to seconds by dividing by 1000 and casting to `int`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[int, int]: A `(start_time_s, end_time_s)` tuple in seconds.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If the watch log file cannot be opened.</span>
<span class="sd">            ValueError: If the file does not contain expected fields/format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">watch_log_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="n">first_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;pts&quot;</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">last_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># TODO change this to make it generally applicable</span>

        <span class="c1"># return cpu time stamp of first and last line in watch log</span>
        <span class="c1"># divide by 1000 to get seconds</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">first_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">last_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_times_from_watch_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_watch_log</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract PTS and CPU (real) times from the watch log.</span>

<span class="sd">        The function reads raw lines via :meth:`getlines`, parses the whitespace-</span>
<span class="sd">        separated fields, and collects two arrays:</span>
<span class="sd">        - PTS values as floats rounded to 2 decimals.</span>
<span class="sd">        - CPU timestamps as integers (original units, **not** yet divided by 1000).</span>

<span class="sd">        It then trims both arrays to the maximum movie duration via</span>
<span class="sd">        :meth:`cut_time_to_movie_pts`.</span>

<span class="sd">        Args:</span>
<span class="sd">            path_watch_log (str): Path to the watch log file to parse.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[np.ndarray, np.ndarray, list[int]]: A tuple</span>
<span class="sd">            ``(pts_time_stamps, cpu_time_stamps, excluded_indices)`` where</span>
<span class="sd">            - `pts_time_stamps` is a float array,</span>
<span class="sd">            - `cpu_time_stamps` is an int array (original unit),</span>
<span class="sd">            - `excluded_indices` lists indices removed due to `MAX_MOVIE_TIME`.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If the watch log file cannot be opened.</span>
<span class="sd">            ValueError: If the log lines do not match the expected 4-field format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlines</span><span class="p">(</span><span class="n">path_watch_log</span><span class="p">)</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">time</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut_time_to_movie_pts</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cut_time_to_movie_pts</span><span class="p">(</span><span class="n">pts_time_stamps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">cpu_time_stamps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trim PTS and CPU arrays to the maximum movie length.</span>

<span class="sd">        Any PTS value strictly greater than :data:`MAX_MOVIE_TIME` is excluded.</span>
<span class="sd">        The function returns aligned arrays of the retained elements and the</span>
<span class="sd">        list of excluded indices.</span>

<span class="sd">        Args:</span>
<span class="sd">            pts_time_stamps (np.ndarray): Array of PTS values (floats).</span>
<span class="sd">            cpu_time_stamps (np.ndarray): Array of CPU times (ints), aligned with PTS.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[np.ndarray, np.ndarray, list[int]]: A tuple</span>
<span class="sd">            ``(cut_down_pts, cut_down_dts, excluded_indices)``:</span>
<span class="sd">            - `cut_down_pts` (np.ndarray): PTS values ≤ `MAX_MOVIE_TIME`.</span>
<span class="sd">            - `cut_down_dts` (np.ndarray): Corresponding CPU times.</span>
<span class="sd">            - `excluded_indices` (list[int]): Indices removed from the original arrays.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This function assumes `pts_time_stamps` and `cpu_time_stamps` are the</span>
<span class="sd">              same length and aligned 1:1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">excluded_time_points_based_on_max_movie_time</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">MAX_MOVIE_TIME</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pts_time_stamps</span><span class="p">]</span>

        <span class="n">cut_down_pts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cut_down_dts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">excluded_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts_time_stamps</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">excluded_time_points_based_on_max_movie_time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cut_down_pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pts_time_stamps</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">cut_down_dts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cpu_time_stamps</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">excluded_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cut_down_pts</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cut_down_dts</span><span class="p">),</span> <span class="n">excluded_indices</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">getlines</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a file in binary mode and return its lines.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Path to the file to read.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[bytes]: Lines of the file as byte strings (no newline characters).</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If the file cannot be opened.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">logfile</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">logfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">lines</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h7 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.get_start_time" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_start_time</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.get_start_time" class="headerlink" title="Permanent link">&para;</a></h7>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_start_time</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the start CPU time (in seconds).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time in seconds.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/watch_log.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the start CPU time (in seconds).</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Start time in seconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.get_end_time" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_end_time</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.get_end_time" class="headerlink" title="Permanent link">&para;</a></h7>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_end_time</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the end CPU time (in seconds).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time in seconds.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/watch_log.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_end_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the end CPU time (in seconds).</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: End time in seconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.extract_start_and_end_time" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">extract_start_and_end_time</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.extract_start_and_end_time" class="headerlink" title="Permanent link">&para;</a></h7>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">extract_start_and_end_time</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract the start and end CPU timestamps from the watch log.</p>
<p>The function reads the file in text mode, takes the second line as the
"first" data line, and scans backward from the end to find the last line
beginning with <code>"pts"</code>. It returns the CPU timestamps from those two
lines, converted to seconds by dividing by 1000 and casting to <code>int</code>.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[int, int]: A <code>(start_time_s, end_time_s)</code> tuple in seconds.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the watch log file cannot be opened.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file does not contain expected fields/format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/watch_log.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_start_and_end_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the start and end CPU timestamps from the watch log.</span>

<span class="sd">    The function reads the file in text mode, takes the second line as the</span>
<span class="sd">    &quot;first&quot; data line, and scans backward from the end to find the last line</span>
<span class="sd">    beginning with ``&quot;pts&quot;``. It returns the CPU timestamps from those two</span>
<span class="sd">    lines, converted to seconds by dividing by 1000 and casting to `int`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[int, int]: A `(start_time_s, end_time_s)` tuple in seconds.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the watch log file cannot be opened.</span>
<span class="sd">        ValueError: If the file does not contain expected fields/format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">watch_log_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;pts&quot;</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">last_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># TODO change this to make it generally applicable</span>

    <span class="c1"># return cpu time stamp of first and last line in watch log</span>
    <span class="c1"># divide by 1000 to get seconds</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">first_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">last_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.get_times_from_watch_log" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_times_from_watch_log</span>


<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.get_times_from_watch_log" class="headerlink" title="Permanent link">&para;</a></h7>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_times_from_watch_log</span><span class="p">(</span><span class="n">path_watch_log</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract PTS and CPU (real) times from the watch log.</p>
<p>The function reads raw lines via :meth:<code>getlines</code>, parses the whitespace-
separated fields, and collects two arrays:
- PTS values as floats rounded to 2 decimals.
- CPU timestamps as integers (original units, <strong>not</strong> yet divided by 1000).</p>
<p>It then trims both arrays to the maximum movie duration via
:meth:<code>cut_time_to_movie_pts</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_watch_log</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the watch log file to parse.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[np.ndarray, np.ndarray, list[int]]: A tuple</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>(pts_time_stamps, cpu_time_stamps, excluded_indices)</code> where</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><code>pts_time_stamps</code> is a float array,</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>, <span title="list">list</span>[<span title="int">int</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><code>cpu_time_stamps</code> is an int array (original unit),</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>, <span title="list">list</span>[<span title="int">int</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><code>excluded_indices</code> lists indices removed due to <code>MAX_MOVIE_TIME</code>.</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the watch log file cannot be opened.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the log lines do not match the expected 4-field format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/watch_log.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_times_from_watch_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_watch_log</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract PTS and CPU (real) times from the watch log.</span>

<span class="sd">    The function reads raw lines via :meth:`getlines`, parses the whitespace-</span>
<span class="sd">    separated fields, and collects two arrays:</span>
<span class="sd">    - PTS values as floats rounded to 2 decimals.</span>
<span class="sd">    - CPU timestamps as integers (original units, **not** yet divided by 1000).</span>

<span class="sd">    It then trims both arrays to the maximum movie duration via</span>
<span class="sd">    :meth:`cut_time_to_movie_pts`.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_watch_log (str): Path to the watch log file to parse.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[np.ndarray, np.ndarray, list[int]]: A tuple</span>
<span class="sd">        ``(pts_time_stamps, cpu_time_stamps, excluded_indices)`` where</span>
<span class="sd">        - `pts_time_stamps` is a float array,</span>
<span class="sd">        - `cpu_time_stamps` is an int array (original unit),</span>
<span class="sd">        - `excluded_indices` lists indices removed due to `MAX_MOVIE_TIME`.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the watch log file cannot be opened.</span>
<span class="sd">        ValueError: If the log lines do not match the expected 4-field format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlines</span><span class="p">(</span><span class="n">path_watch_log</span><span class="p">)</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">time</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut_time_to_movie_pts</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.cut_time_to_movie_pts" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">cut_time_to_movie_pts</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.cut_time_to_movie_pts" class="headerlink" title="Permanent link">&para;</a></h7>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">cut_time_to_movie_pts</span><span class="p">(</span><span class="n">pts_time_stamps</span><span class="p">,</span> <span class="n">cpu_time_stamps</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Trim PTS and CPU arrays to the maximum movie length.</p>
<p>Any PTS value strictly greater than :data:<code>MAX_MOVIE_TIME</code> is excluded.
The function returns aligned arrays of the retained elements and the
list of excluded indices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pts_time_stamps</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of PTS values (floats).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cpu_time_stamps</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of CPU times (ints), aligned with PTS.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[np.ndarray, np.ndarray, list[int]]: A tuple</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>(cut_down_pts, cut_down_dts, excluded_indices)</code>:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><code>cut_down_pts</code> (np.ndarray): PTS values ≤ <code>MAX_MOVIE_TIME</code>.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>, <span title="list">list</span>[<span title="int">int</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><code>cut_down_dts</code> (np.ndarray): Corresponding CPU times.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>, <span title="list">list</span>[<span title="int">int</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><code>excluded_indices</code> (list[int]): Indices removed from the original arrays.</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>This function assumes <code>pts_time_stamps</code> and <code>cpu_time_stamps</code> are the
  same length and aligned 1:1.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/watch_log.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cut_time_to_movie_pts</span><span class="p">(</span><span class="n">pts_time_stamps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">cpu_time_stamps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trim PTS and CPU arrays to the maximum movie length.</span>

<span class="sd">    Any PTS value strictly greater than :data:`MAX_MOVIE_TIME` is excluded.</span>
<span class="sd">    The function returns aligned arrays of the retained elements and the</span>
<span class="sd">    list of excluded indices.</span>

<span class="sd">    Args:</span>
<span class="sd">        pts_time_stamps (np.ndarray): Array of PTS values (floats).</span>
<span class="sd">        cpu_time_stamps (np.ndarray): Array of CPU times (ints), aligned with PTS.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[np.ndarray, np.ndarray, list[int]]: A tuple</span>
<span class="sd">        ``(cut_down_pts, cut_down_dts, excluded_indices)``:</span>
<span class="sd">        - `cut_down_pts` (np.ndarray): PTS values ≤ `MAX_MOVIE_TIME`.</span>
<span class="sd">        - `cut_down_dts` (np.ndarray): Corresponding CPU times.</span>
<span class="sd">        - `excluded_indices` (list[int]): Indices removed from the original arrays.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - This function assumes `pts_time_stamps` and `cpu_time_stamps` are the</span>
<span class="sd">          same length and aligned 1:1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">excluded_time_points_based_on_max_movie_time</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">MAX_MOVIE_TIME</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pts_time_stamps</span><span class="p">]</span>

    <span class="n">cut_down_pts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cut_down_dts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">excluded_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts_time_stamps</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">excluded_time_points_based_on_max_movie_time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cut_down_pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pts_time_stamps</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">cut_down_dts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cpu_time_stamps</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">excluded_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cut_down_pts</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cut_down_dts</span><span class="p">),</span> <span class="n">excluded_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.getlines" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">getlines</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#epiphyte.preprocessing.annotation.stimulus_driven_annotation.movies.watch_log.WatchLog.getlines" class="headerlink" title="Permanent link">&para;</a></h7>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">getlines</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Read a file in binary mode and return its lines.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the file to read.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="bytes">bytes</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[bytes]: Lines of the file as byte strings (no newline characters).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file cannot be opened.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/annotation/stimulus_driven_annotation/movies/watch_log.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">getlines</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a file in binary mode and return its lines.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): Path to the file to read.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[bytes]: Lines of the file as byte strings (no newline characters).</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the file cannot be opened.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">logfile</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">logfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="epiphyte.preprocessing.data_preprocessing" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">data_preprocessing</span>


<a href="#epiphyte.preprocessing.data_preprocessing" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">










  <div class="doc doc-children">











<div class="doc doc-object doc-module">



<h3 id="epiphyte.preprocessing.data_preprocessing.binning" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">binning</span>


<a href="#epiphyte.preprocessing.data_preprocessing.binning" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

        <p>Binning functions for spike times and labels. 
Pulls data from the database using pre-defined query functions.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.binning.bin_label" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">bin_label</span>


<a href="#epiphyte.preprocessing.data_preprocessing.binning.bin_label" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">bin_label</span><span class="p">(</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">session_nr</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">start_times</span><span class="p">,</span> <span class="n">stop_times</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">,</span> <span class="n">exclude_pauses</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Bin a label timeline against fixed-size bins.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>patient_id</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of patient.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session_nr</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Session number for the movie watching.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values of the label per segment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start times (ms) per segment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stop_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stop times (ms) per segment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bin_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of one bin in milliseconds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_pauses</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, exclude paused playback intervals.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Indicator vector (one value per bin).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/binning.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bin_label</span><span class="p">(</span>
    <span class="n">patient_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">session_nr</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">start_times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">stop_times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">bin_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">exclude_pauses</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bin a label timeline against fixed-size bins.</span>

<span class="sd">    Args:</span>
<span class="sd">        patient_id (int): ID of patient.</span>
<span class="sd">        session_nr (int): Session number for the movie watching.</span>
<span class="sd">        values (np.ndarray): Values of the label per segment.</span>
<span class="sd">        start_times (np.ndarray): Start times (ms) per segment.</span>
<span class="sd">        stop_times (np.ndarray): Stop times (ms) per segment.</span>
<span class="sd">        bin_size (int): Size of one bin in milliseconds.</span>
<span class="sd">        exclude_pauses (bool): If ``True``, exclude paused playback intervals.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Indicator vector (one value per bin).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">neural_rec_time</span> <span class="o">=</span> <span class="n">get_neural_rectime_of_patient</span><span class="p">(</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">session_nr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">rec_on</span> <span class="o">=</span> <span class="n">neural_rec_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rec_off</span> <span class="o">=</span> <span class="n">neural_rec_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">total_msec</span> <span class="o">=</span> <span class="n">rec_off</span> <span class="o">-</span> <span class="n">rec_on</span>
    <span class="n">total_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_msec</span> <span class="o">/</span> <span class="n">bin_size</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rec_on</span><span class="p">,</span> <span class="n">rec_off</span><span class="p">,</span> <span class="n">total_bins</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">exclude_pauses</span><span class="p">:</span>  
        <span class="n">start_times_pauses</span><span class="p">,</span> <span class="n">stop_times_pauses</span> <span class="o">=</span> <span class="n">get_start_stop_times_pauses</span><span class="p">(</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">session_nr</span><span class="p">)</span>
        <span class="n">bins_no_pauses</span> <span class="o">=</span> <span class="n">pause_handling</span><span class="o">.</span><span class="n">rm_pauses_bins</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">start_times_pauses</span><span class="p">,</span> <span class="n">stop_times_pauses</span><span class="p">)</span>
        <span class="n">reference_vector</span> <span class="o">=</span> <span class="n">bins_no_pauses</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reference_vector</span> <span class="o">=</span> <span class="n">bins</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;neural_rec_time.npy&quot;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;neural_rec_time.npy&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">create_vectors_from_time_points</span><span class="o">.</span><span class="n">create_vector_from_start_stop_times_reference</span><span class="p">(</span><span class="n">reference_vector</span><span class="p">,</span>
                                                                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
                                                                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">start_times</span><span class="p">),</span>
                                                                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stop_times</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.binning.bin_spikes" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">bin_spikes</span>


<a href="#epiphyte.preprocessing.data_preprocessing.binning.bin_spikes" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">bin_spikes</span><span class="p">(</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">session_nr</span><span class="p">,</span> <span class="n">spike_times</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">,</span> <span class="n">exclude_pauses</span><span class="p">,</span> <span class="n">output_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Bin spike times into fixed-size bins.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>patient_id</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the patient.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session_nr</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Session number of the experiment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spike_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spike timestamps (ms) as a vector.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bin_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bin size in milliseconds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_pauses</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, exclude paused playback intervals.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_edges</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, also return the bin edges used.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[np.ndarray, List[np.ndarray]]: Binned spikes or <code>[binned_spikes, bin_edges]</code> if requested.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/binning.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bin_spikes</span><span class="p">(</span>
    <span class="n">patient_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">session_nr</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">spike_times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">bin_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">exclude_pauses</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">output_edges</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bin spike times into fixed-size bins.</span>

<span class="sd">    Args:</span>
<span class="sd">        patient_id (int): ID of the patient.</span>
<span class="sd">        session_nr (int): Session number of the experiment.</span>
<span class="sd">        spike_times (np.ndarray): Spike timestamps (ms) as a vector.</span>
<span class="sd">        bin_size (int): Bin size in milliseconds.</span>
<span class="sd">        exclude_pauses (bool): If ``True``, exclude paused playback intervals.</span>
<span class="sd">        output_edges (bool): If ``True``, also return the bin edges used.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[np.ndarray, List[np.ndarray]]: Binned spikes or ``[binned_spikes, bin_edges]`` if requested.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rectime</span> <span class="o">=</span> <span class="n">get_neural_rectime_of_patient</span><span class="p">(</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">session_nr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">rec_on</span> <span class="o">=</span> <span class="n">rectime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rec_off</span> <span class="o">=</span> <span class="n">rectime</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">total_msec</span> <span class="o">=</span> <span class="n">rec_off</span> <span class="o">-</span> <span class="n">rec_on</span>
    <span class="n">total_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_msec</span> <span class="o">/</span> <span class="n">bin_size</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rec_on</span><span class="p">,</span> <span class="n">rec_off</span><span class="p">,</span> <span class="n">total_bins</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">exclude_pauses</span><span class="p">:</span>
        <span class="n">start_times_pauses</span><span class="p">,</span> <span class="n">stop_times_pauses</span> <span class="o">=</span> <span class="n">get_start_stop_times_pauses</span><span class="p">(</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">session_nr</span><span class="p">)</span>

        <span class="c1"># rescale pauses from microseconds to milliseconds</span>
        <span class="n">start_times_pauses</span> <span class="o">=</span> <span class="n">start_times_pauses</span> <span class="o">/</span> <span class="mi">1000</span>
        <span class="n">stop_times_pauses</span> <span class="o">=</span> <span class="n">stop_times_pauses</span> <span class="o">/</span> <span class="mi">1000</span>

        <span class="c1"># remove the pauses from the binning edges</span>
        <span class="n">bins_no_pauses</span> <span class="o">=</span> <span class="n">pause_handling</span><span class="o">.</span><span class="n">rm_pauses_bins</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">start_times_pauses</span><span class="p">,</span> <span class="n">stop_times_pauses</span><span class="p">)</span>
        <span class="n">unit_no_pauses</span><span class="p">,</span> <span class="n">pause_spks</span> <span class="o">=</span> <span class="n">pause_handling</span><span class="o">.</span><span class="n">rm_pauses_spikes</span><span class="p">(</span><span class="n">spike_times</span><span class="p">,</span> <span class="n">start_times_pauses</span><span class="p">,</span> <span class="n">stop_times_pauses</span><span class="p">,</span>
                                                                     <span class="n">return_intervals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># bin spikes</span>
        <span class="n">binned_spikes</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">unit_no_pauses</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins_no_pauses</span><span class="p">)</span>

        <span class="c1"># output updated to bins without pause</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">bins_no_pauses</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># bin spikes</span>
        <span class="n">binned_spikes</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">spike_times</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output_edges</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="n">binned_spikes</span><span class="p">,</span> <span class="n">bins</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">ret</span> <span class="o">=</span> <span class="n">binned_spikes</span>

    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">create_vectors_from_time_points</span>


<a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

        <p>Functions related to processing the db stored time points (start/stop/values) into vectors for use in analysis.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_index_nearest_timestamp_in_vector" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_index_nearest_timestamp_in_vector</span>


<a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_index_nearest_timestamp_in_vector" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_index_nearest_timestamp_in_vector</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Finds the index of the value in a vector that is nearest to a given timestamp.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vector</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The array of timestamps to search.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timestamp</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target timestamp to find the nearest value to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    int: The index of the value in <code>vector</code> that is closest to <code>timestamp</code>.</p>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="n">vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">])</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">get_index_nearest_timestamp_in_vector</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
<span class="c1"># idx == 1</span>
</code></pre></div>
</details>

            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/create_vectors_from_time_points.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_index_nearest_timestamp_in_vector</span><span class="p">(</span><span class="n">vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the index of the value in a vector that is nearest to a given timestamp.</span>

<span class="sd">    Args:</span>
<span class="sd">        vector (np.ndarray): The array of timestamps to search.</span>
<span class="sd">        timestamp (float): The target timestamp to find the nearest value to.</span>
<span class="sd">    Returns:</span>
<span class="sd">        int: The index of the value in `vector` that is closest to `timestamp`.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        vector = np.array([1.0, 2.5, 3.8, 5.0])</span>
<span class="sd">        idx = get_index_nearest_timestamp_in_vector(vector, 3.0)</span>
<span class="sd">        # idx == 1</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> <span class="o">-</span> <span class="n">timestamp</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_nearest_value_from_vector" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_nearest_value_from_vector</span>


<a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_nearest_value_from_vector" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_nearest_value_from_vector</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Finds the value in a vector closest to a given timestamp.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vector</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of values to search.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timestamp</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target timestamp to find the nearest value to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value from the vector that is closest to the given timestamp.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">])</span>
<span class="n">get_nearest_value_from_vector</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
<span class="mf">3.8</span>
</code></pre></div>
</details>

            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/create_vectors_from_time_points.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_nearest_value_from_vector</span><span class="p">(</span><span class="n">vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the value in a vector closest to a given timestamp.</span>

<span class="sd">    Args:</span>
<span class="sd">        vector (np.ndarray): Array of values to search.</span>
<span class="sd">        timestamp (float): Target timestamp to find the nearest value to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The value from the vector that is closest to the given timestamp.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        import numpy as np</span>
<span class="sd">        vector = np.array([1.0, 2.5, 3.8, 5.0])</span>
<span class="sd">        get_nearest_value_from_vector(vector, 4.0)</span>
<span class="sd">        3.8</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">vector</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">timestamp</span><span class="p">)))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>  <span class="c1"># row number with matching pts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.create_vector_from_start_stop_times_reference_cont_watch" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">create_vector_from_start_stop_times_reference_cont_watch</span>


<a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.create_vector_from_start_stop_times_reference_cont_watch" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">create_vector_from_start_stop_times_reference_cont_watch</span><span class="p">(</span><span class="n">reference_vector</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">stops</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a vector aligned to a reference vector using provided start and stop times and corresponding values.</p>
<p>This function generates an indicator vector where each segment, defined by its start and stop times, is filled with the associated value. The output vector is aligned to the bins defined by the reference vector, which represents the edges of the bins.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reference_vector</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of timestamps or bin edges to which the output vector will be aligned.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of values to assign to each segment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>starts</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of start times for each segment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stops</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of stop times for each segment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: 
Indicator vector aligned to the reference vector, with values assigned according to the specified intervals.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <p>Prints an error and returns -1 if the lengths of <code>values</code>, <code>starts</code>, and <code>stops</code> do not match.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/create_vectors_from_time_points.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_vector_from_start_stop_times_reference_cont_watch</span><span class="p">(</span>
    <span class="n">reference_vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">starts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">stops</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a vector aligned to a reference vector using provided start and stop times and corresponding values.</span>

<span class="sd">    This function generates an indicator vector where each segment, defined by its start and stop times, is filled with the associated value. The output vector is aligned to the bins defined by the reference vector, which represents the edges of the bins.</span>

<span class="sd">    Args:</span>
<span class="sd">        reference_vector (np.ndarray): </span>
<span class="sd">            Array of timestamps or bin edges to which the output vector will be aligned.</span>
<span class="sd">        values (np.ndarray): </span>
<span class="sd">            Array of values to assign to each segment.</span>
<span class="sd">        starts (np.ndarray): </span>
<span class="sd">            Array of start times for each segment.</span>
<span class="sd">        stops (np.ndarray): </span>
<span class="sd">            Array of stop times for each segment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: </span>
<span class="sd">            Indicator vector aligned to the reference vector, with values assigned according to the specified intervals.</span>

<span class="sd">    Notes:</span>
<span class="sd">        Prints an error and returns -1 if the lengths of `values`, `starts`, and `stops` do not match.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check if input has the correct format</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">starts</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">stops</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;vectors values, starts and stops have to be the same length&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">nr_intervals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nr_intervals</span><span class="p">):</span>
        <span class="n">index_dts_start</span> <span class="o">=</span> <span class="n">get_index_nearest_timestamp_in_vector</span><span class="p">(</span><span class="n">reference_vector</span><span class="p">,</span> <span class="n">starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">index_dts_stop</span> <span class="o">=</span> <span class="n">get_index_nearest_timestamp_in_vector</span><span class="p">(</span><span class="n">reference_vector</span><span class="p">,</span> <span class="n">stops</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">length_interval</span> <span class="o">=</span> <span class="n">index_dts_stop</span> <span class="o">-</span> <span class="n">index_dts_start</span>
        <span class="k">if</span> <span class="n">length_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="n">length_interval</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.create_vector_from_start_stop_times" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">create_vector_from_start_stop_times</span>


<a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.create_vector_from_start_stop_times" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">create_vector_from_start_stop_times</span><span class="p">(</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">session_nr</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">stops</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Less powerful version of the function create_vector_from_start_stop_times_reference_cont_watch</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>patient_id</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of patient</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session_nr</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>unique number of session of patient</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array indicating all values in the right order</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>starts</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array indicating all start times of all segments in the right order</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stops</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array indicating all stop times of all segments as a vector in the right order</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Indicator function aligned to reference vector.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/create_vectors_from_time_points.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_vector_from_start_stop_times</span><span class="p">(</span>
    <span class="n">patient_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">session_nr</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">starts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">stops</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Less powerful version of the function create_vector_from_start_stop_times_reference_cont_watch</span>

<span class="sd">    Args:</span>
<span class="sd">        patient_id (int): ID of patient</span>
<span class="sd">        session_nr (int): unique number of session of patient</span>
<span class="sd">        values (np.ndarray): array indicating all values in the right order</span>
<span class="sd">        starts (np.ndarray): array indicating all start times of all segments in the right order</span>
<span class="sd">        stops (np.ndarray): array indicating all stop times of all segments as a vector in the right order</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Indicator function aligned to reference vector.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">neural_rec_time</span> <span class="o">=</span> <span class="n">get_neural_rectime_of_patient</span><span class="p">(</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">session_nr</span><span class="p">)</span>

    <span class="c1"># check if input has the correct format</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">starts</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">stops</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;vectors values, starts and stops have to be the same length&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">nr_intervals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nr_intervals</span><span class="p">):</span>
        <span class="n">index_dts_start</span> <span class="o">=</span> <span class="n">get_index_nearest_timestamp_in_vector</span><span class="p">(</span><span class="n">neural_rec_time</span><span class="p">,</span> <span class="n">starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">index_dts_stop</span> <span class="o">=</span> <span class="n">get_index_nearest_timestamp_in_vector</span><span class="p">(</span><span class="n">neural_rec_time</span><span class="p">,</span> <span class="n">stops</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">length_interval</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">neural_rec_time</span><span class="p">[</span><span class="n">index_dts_start</span><span class="p">:</span><span class="n">index_dts_stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">length_interval</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_start_stop_times_from_label" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_start_stop_times_from_label</span>


<a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_start_stop_times_from_label" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_start_stop_times_from_label</span><span class="p">(</span><span class="n">neural_rec_time</span><span class="p">,</span> <span class="n">patient_aligned_label</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This function extracts the start and stop times from a label.
<code>patient_aligned_label</code> has to have the same length as <code>neural_rec_time</code>
The time points in the resulting vectors are in neural recording time</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>neural_rec_time</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array indicating neural recording time</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patient_aligned_label</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array indicating label aligned to patient time</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code><span title="tuple">tuple</span>[<span title="list">list</span>, <span title="list">list</span>, <span title="list">list</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>(values, start_times, stop_times)</code> arrays.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/create_vectors_from_time_points.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_start_stop_times_from_label</span><span class="p">(</span>
    <span class="n">neural_rec_time</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">patient_aligned_label</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts the start and stop times from a label.</span>
<span class="sd">    `patient_aligned_label` has to have the same length as `neural_rec_time`</span>
<span class="sd">    The time points in the resulting vectors are in neural recording time</span>

<span class="sd">    Args:</span>
<span class="sd">        neural_rec_time (np.ndarray): array indicating neural recording time</span>
<span class="sd">        patient_aligned_label (np.ndarray): array indicating label aligned to patient time</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: ``(values, start_times, stop_times)`` arrays.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">patient_aligned_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp</span><span class="p">]</span>
    <span class="n">start_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">neural_rec_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">stop_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">patient_aligned_label</span><span class="p">)):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">patient_aligned_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">tmp</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patient_aligned_label</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">start_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neural_rec_time</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">stop_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neural_rec_time</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">patient_aligned_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">stop_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neural_rec_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">values</span><span class="p">,</span> <span class="n">start_times</span><span class="p">,</span> <span class="n">stop_times</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_bins_excl_pauses" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_bins_excl_pauses</span>


<a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_bins_excl_pauses" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_bins_excl_pauses</span><span class="p">(</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">session_nr</span><span class="p">,</span> <span class="n">neural_rec_time</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns edges of bins for a given patient with the right bin size, while excluding bins where the movie was paused.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>patient_id</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of patient</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session_nr</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>session number</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>neural_rec_time</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector of neural recording time of patient</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bin_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>size of bin in milliseconds</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Edges of bins, excluding paused intervals.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/create_vectors_from_time_points.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_bins_excl_pauses</span><span class="p">(</span>
    <span class="n">patient_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">session_nr</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">neural_rec_time</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns edges of bins for a given patient with the right bin size, while excluding bins where the movie was paused.</span>

<span class="sd">    Args:</span>
<span class="sd">        patient_id (int): ID of patient</span>
<span class="sd">        session_nr (int): session number</span>
<span class="sd">        neural_rec_time (np.ndarray): vector of neural recording time of patient</span>
<span class="sd">        bin_size (int): size of bin in milliseconds</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Edges of bins, excluding paused intervals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_times_pauses</span><span class="p">,</span> <span class="n">stop_times_pauses</span> <span class="o">=</span> <span class="n">get_start_stop_times_pauses</span><span class="p">(</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">session_nr</span><span class="p">)</span>
    <span class="n">rec_on</span> <span class="o">=</span> <span class="n">neural_rec_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rec_off</span> <span class="o">=</span> <span class="n">neural_rec_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">total_msec</span> <span class="o">=</span> <span class="n">rec_off</span> <span class="o">-</span> <span class="n">rec_on</span>
    <span class="n">total_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_msec</span> <span class="o">/</span> <span class="n">bin_size</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rec_on</span><span class="p">,</span> <span class="n">rec_off</span><span class="p">,</span> <span class="n">total_bins</span><span class="p">)</span>
    <span class="n">bins_no_pauses</span> <span class="o">=</span> <span class="n">pause_handling</span><span class="o">.</span><span class="n">rm_pauses_bins</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">start_times_pauses</span><span class="p">,</span> <span class="n">stop_times_pauses</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bins_no_pauses</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.create_vector_from_start_stop_times_reference" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">create_vector_from_start_stop_times_reference</span>


<a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.create_vector_from_start_stop_times_reference" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">create_vector_from_start_stop_times_reference</span><span class="p">(</span><span class="n">reference_vector</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">stops</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create an indicator function from values, start and stop times of a label aligned to a reference vector of time points. 
Used to create an indicator function (vector indicating if a labelled feature was present during the interval between two time points) from a set of bin edges. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reference_vector</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector of linearly spaced time points (e.g. bin edges)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>values indicating presence or absence of a labeled feature</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>starts</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>start times of the corresponding values </p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stops</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>stop times of the corresponding values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: indicator function vector.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/create_vectors_from_time_points.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_vector_from_start_stop_times_reference</span><span class="p">(</span>
    <span class="n">reference_vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">starts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">stops</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an indicator function from values, start and stop times of a label aligned to a reference vector of time points. </span>
<span class="sd">    Used to create an indicator function (vector indicating if a labelled feature was present during the interval between two time points) from a set of bin edges. </span>

<span class="sd">    Args:</span>
<span class="sd">        reference_vector (np.ndarray): vector of linearly spaced time points (e.g. bin edges)</span>
<span class="sd">        values (np.ndarray): values indicating presence or absence of a labeled feature</span>
<span class="sd">        starts (np.ndarray): start times of the corresponding values </span>
<span class="sd">        stops (np.ndarray): stop times of the corresponding values</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: indicator function vector.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check if input has the correct format</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">starts</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">stops</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;vectors values, starts and stops have to be the same length&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">reference_vector</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">get_value_in_time_frame</span><span class="p">(</span><span class="n">time_point1</span><span class="o">=</span><span class="n">reference_vector</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">time_point2</span><span class="o">=</span><span class="n">reference_vector</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                        <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">start_times</span><span class="o">=</span><span class="n">starts</span><span class="p">,</span> <span class="n">end_times</span><span class="o">=</span><span class="n">stops</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_value_matching_start_point" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_value_matching_start_point</span>


<a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_value_matching_start_point" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_value_matching_start_point</span><span class="p">(</span><span class="n">time_point</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">start_times</span><span class="p">,</span> <span class="n">end_times</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Finds the value in a vector that corresponds to the closest start time less than or equal to a given time point.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_point</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the time point for which the value shall be searched</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all start times</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all stop times</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value corresponding to the time point.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/create_vectors_from_time_points.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_value_matching_start_point</span><span class="p">(</span>
    <span class="n">time_point</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">start_times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">end_times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the value in a vector that corresponds to the closest start time less than or equal to a given time point.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_point (float): the time point for which the value shall be searched</span>
<span class="sd">        values (np.ndarray): vector with all values</span>
<span class="sd">        start_times (np.ndarray): vector with all start times</span>
<span class="sd">        end_times (np.ndarray): vector with all stop times</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Value corresponding to the time point.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">get_index_nearest_timestamp_in_vector</span><span class="p">(</span><span class="n">start_times</span><span class="p">,</span> <span class="n">time_point</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">time_point</span> <span class="o">&lt;</span> <span class="n">start_times</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">time_point</span> <span class="o">&lt;=</span> <span class="n">start_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">index</span>
        <span class="n">index</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_value_matching_stop_point" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_value_matching_stop_point</span>


<a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_value_matching_stop_point" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_value_matching_stop_point</span><span class="p">(</span><span class="n">time_point</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">start_times</span><span class="p">,</span> <span class="n">end_times</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Finds the value in a vector that corresponds to the closest stop time less than or equal to a given time point.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_point</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the time point for which the value shall be searched</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all start times</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all stop times</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value corresponding to the time point.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/create_vectors_from_time_points.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_value_matching_stop_point</span><span class="p">(</span>
    <span class="n">time_point</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">start_times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">end_times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the value in a vector that corresponds to the closest stop time less than or equal to a given time point.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_point (float): the time point for which the value shall be searched</span>
<span class="sd">        values (np.ndarray): vector with all values</span>
<span class="sd">        start_times (np.ndarray): vector with all start times</span>
<span class="sd">        end_times (np.ndarray): vector with all stop times</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Value corresponding to the time point.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">index</span> <span class="o">=</span> <span class="n">get_index_nearest_timestamp_in_vector</span><span class="p">(</span><span class="n">end_times</span><span class="p">,</span> <span class="n">time_point</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">time_point</span> <span class="o">&gt;=</span> <span class="n">end_times</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">time_point</span> <span class="o">&gt;=</span> <span class="n">end_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">index</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_index_matching_start_point" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_index_matching_start_point</span>


<a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_index_matching_start_point" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_index_matching_start_point</span><span class="p">(</span><span class="n">time_point</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">start_times</span><span class="p">,</span> <span class="n">end_times</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Finds the index of the start point that is the closest start point smaller than 'time_point'.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_point</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the time point for which the value shall be searched</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all start times</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all stop times</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value corresponding to the time point.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/create_vectors_from_time_points.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_index_matching_start_point</span><span class="p">(</span>
    <span class="n">time_point</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">start_times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">end_times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the index of the start point that is the closest start point smaller than &#39;time_point&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_point (float): the time point for which the value shall be searched</span>
<span class="sd">        values (np.ndarray): vector with all values</span>
<span class="sd">        start_times (np.ndarray): vector with all start times</span>
<span class="sd">        end_times (np.ndarray): vector with all stop times</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Value corresponding to the time point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">get_index_nearest_timestamp_in_vector</span><span class="p">(</span><span class="n">start_times</span><span class="p">,</span> <span class="n">time_point</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">time_point</span> <span class="o">&lt;</span> <span class="n">start_times</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">time_point</span> <span class="o">&lt;</span> <span class="n">start_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">index</span>
        <span class="n">index</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">index</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_index_matching_stop_point" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_index_matching_stop_point</span>


<a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_index_matching_stop_point" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_index_matching_stop_point</span><span class="p">(</span><span class="n">time_point</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">start_times</span><span class="p">,</span> <span class="n">end_times</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Finds the index of the stop point that is the closest stop point greater than 'time_point'.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_point</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the time point for which the value shall be searched</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all start times</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all stop times</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value corresponding to the time point.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/create_vectors_from_time_points.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_index_matching_stop_point</span><span class="p">(</span>
    <span class="n">time_point</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">start_times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">end_times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the index of the stop point that is the closest stop point greater than &#39;time_point&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_point (float): the time point for which the value shall be searched</span>
<span class="sd">        values (np.ndarray): vector with all values</span>
<span class="sd">        start_times (np.ndarray): vector with all start times</span>
<span class="sd">        end_times (np.ndarray): vector with all stop times</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Value corresponding to the time point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">get_index_nearest_timestamp_in_vector</span><span class="p">(</span><span class="n">end_times</span><span class="p">,</span> <span class="n">time_point</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">time_point</span> <span class="o">&gt;=</span> <span class="n">end_times</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">time_point</span> <span class="o">&gt;=</span> <span class="n">end_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">index</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">index</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_value_in_time_frame" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_value_in_time_frame</span>


<a href="#epiphyte.preprocessing.data_preprocessing.create_vectors_from_time_points.get_value_in_time_frame" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_value_in_time_frame</span><span class="p">(</span><span class="n">time_point1</span><span class="p">,</span> <span class="n">time_point2</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">start_times</span><span class="p">,</span> <span class="n">end_times</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Finds the value that is most represented between two time points.
Needed for creating an indicator function from a set of bin edges with a bin size longer than the frame length, as a bin could contain multiple segments with different values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_point1</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower bound of time frame         </p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_point2</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>upper bound of time frame that is regarded</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all start time points</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vector with all stop time points</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>value most represented within the time frame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/create_vectors_from_time_points.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_value_in_time_frame</span><span class="p">(</span>
    <span class="n">time_point1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">time_point2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">start_times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">end_times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the value that is most represented between two time points.</span>
<span class="sd">    Needed for creating an indicator function from a set of bin edges with a bin size longer than the frame length, as a bin could contain multiple segments with different values.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_point1 (float): lower bound of time frame         </span>
<span class="sd">        time_point2 (float): upper bound of time frame that is regarded</span>
<span class="sd">        values (np.ndarray): vector with all values</span>
<span class="sd">        start_times (np.ndarray): vector with all start time points</span>
<span class="sd">        end_times (np.ndarray): vector with all stop time points</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: value most represented within the time frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">index_1</span> <span class="o">=</span> <span class="n">get_index_matching_start_point</span><span class="p">(</span><span class="n">time_point1</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">start_times</span><span class="p">,</span> <span class="n">end_times</span><span class="p">)</span>
    <span class="n">index_2</span> <span class="o">=</span> <span class="n">get_index_matching_stop_point</span><span class="p">(</span><span class="n">time_point2</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">start_times</span><span class="p">,</span> <span class="n">end_times</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index_1</span> <span class="o">==</span> <span class="n">index_2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="n">index_1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;weighing&quot;</span><span class="p">])</span>
        <span class="c1"># first interval: add weighing of end_point of this segment - timepoint1</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="n">index_1</span><span class="p">],</span> <span class="s2">&quot;weighing&quot;</span><span class="p">:</span> <span class="n">end_times</span><span class="p">[</span><span class="n">index_1</span><span class="p">]</span> <span class="o">-</span> <span class="n">time_point1</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># all in between intervals: add weighing of length of segment</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">index_2</span> <span class="o">-</span> <span class="n">index_1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="n">index_1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">values</span><span class="p">[</span><span class="n">index_1</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span> <span class="s2">&quot;weighing&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">end_times</span><span class="p">[</span><span class="n">index_1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_times</span><span class="p">[</span>
                    <span class="n">index_1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="n">index_1</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span> <span class="s2">&quot;weighing&quot;</span><span class="p">:</span> <span class="n">end_times</span><span class="p">[</span><span class="n">index_1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_times</span><span class="p">[</span><span class="n">index_1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]},</span>
                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># last interval: add weighing of timepoint2 - start_point of this segment</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="n">index_2</span><span class="p">],</span> <span class="s2">&quot;weighing&quot;</span><span class="p">:</span> <span class="n">time_point2</span> <span class="o">-</span> <span class="n">start_times</span><span class="p">[</span><span class="n">index_2</span><span class="p">]},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;weighing&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weighing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()][</span><span class="s2">&quot;value&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="epiphyte.preprocessing.data_preprocessing.data_utils" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">data_utils</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

        <p>I/O and time-alignment utilities for Neuralynx-like event logs.</p>
<p>Provides helpers to read <code>.nev</code> (and mock <code>.npy</code>) event files, parse
watchlogs/DAQ logs, and linearly align between local computer time and neural
recording system time.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="epiphyte.preprocessing.data_preprocessing.data_utils.TimeConversion" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">TimeConversion</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.TimeConversion" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>


        <p>Linear mapping between CPU time and neural recording time.</p>
<p>Enables conversion of stimulus timestamps (e.g., movie frames) to the spike
time scale.</p>








              <details class="quote">
                <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TimeConversion</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Linear mapping between CPU time and neural recording time.</span>

<span class="sd">    Enables conversion of stimulus timestamps (e.g., movie frames) to the spike</span>
<span class="sd">    time scale.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_to_wl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">path_to_dl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
                 <span class="n">path_to_events</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_watchlog</span> <span class="o">=</span> <span class="n">path_to_wl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_daqlog</span> <span class="o">=</span> <span class="n">path_to_dl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_evts</span> <span class="o">=</span> <span class="n">path_to_events</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute mapping and convert watchlog times to DAQ times.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[np.ndarray, np.ndarray, np.ndarray]: ``(pts_seconds, dts_ms, cpu_time_us)`` arrays.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">event_mat</span> <span class="o">=</span> <span class="n">process_events</span><span class="p">(</span><span class="n">nev_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_evts</span><span class="p">))</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">get_coeff</span><span class="p">(</span><span class="n">event_mat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_daqlog</span><span class="p">)</span>
        <span class="n">pts</span><span class="p">,</span> <span class="n">cpu_time</span> <span class="o">=</span> <span class="n">read_watchlog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_watchlog</span><span class="p">)</span>

        <span class="c1"># first convert cpu time to recording system time</span>
        <span class="n">daq_time</span> <span class="o">=</span> <span class="n">cpu_time</span> <span class="o">*</span> <span class="n">m</span> <span class="o">+</span> <span class="n">b</span>

        <span class="k">return</span> <span class="n">pts</span><span class="p">,</span> <span class="n">daq_time</span><span class="p">,</span> <span class="n">cpu_time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_pauses</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert pause CPU timestamps to neural recording time.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[List[float], List[float]]: ``(starts_ms, stops_ms)`` lists in neural recording time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">read_watchlog_pauses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_watchlog</span><span class="p">)</span>
        <span class="n">event_mat</span> <span class="o">=</span> <span class="n">process_events</span><span class="p">(</span><span class="n">nev_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_evts</span><span class="p">))</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">get_coeff</span><span class="p">(</span><span class="n">event_mat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_daqlog</span><span class="p">)</span>

        <span class="n">convert_start</span> <span class="o">=</span> <span class="p">[</span><span class="n">time</span> <span class="o">*</span> <span class="n">m</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">start</span><span class="p">)]</span>
        <span class="n">convert_stop</span> <span class="o">=</span> <span class="p">[</span><span class="n">time</span> <span class="o">*</span> <span class="n">m</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stop</span><span class="p">)]</span>

        <span class="c1">#### NOTE: depending on the output set-up, comment/uncomment. </span>
        <span class="c1">##### Generally, can use the highlights options on the interactive plot</span>
        <span class="c1">##### to indicate if time-scales are not coherent between the data and the </span>
        <span class="c1">##### pauses. </span>
        <span class="c1">#convert_start = make_msec(convert_start)</span>
        <span class="c1">#convert_stop = make_msec(convert_stop)</span>

        <span class="k">return</span> <span class="n">convert_start</span><span class="p">,</span> <span class="n">convert_stop</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">convert_skips</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect skips and return start/stop/value segments in DAQ time.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[np.ndarray, np.ndarray, np.ndarray]: ``(start_values_ms, stop_values_ms, values_idx)`` arrays.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pts</span><span class="p">,</span> <span class="n">daq_time</span><span class="p">,</span> <span class="n">cpu_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>

        <span class="n">threshold</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">max_jump</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pts</span><span class="p">)))</span>


        <span class="k">if</span> <span class="n">max_jump</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is a skip in the movie frame playback that is bigger than </span><span class="si">{}</span><span class="s2"> frames.</span><span class="se">\n</span><span class="s2">The biggest skip is </span><span class="si">{}</span><span class="s2"> frames.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">threshold</span> <span class="o">/</span> <span class="mf">0.04</span><span class="p">),</span> <span class="p">(</span><span class="n">max_jump</span> <span class="o">/</span> <span class="mf">0.04</span><span class="p">)))</span>

            <span class="c1"># list of indices where the pts jumped by 25+ frames</span>
            <span class="n">beyond_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pts</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Timepoints of skips, in neural_rec_time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">daq_time</span><span class="p">[</span><span class="n">beyond_threshold</span><span class="p">]))</span>

            <span class="c1">## setting up start/stop values</span>
            <span class="n">timepoints_of_skips</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">timepoints_of_skips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">daq_time</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># set first start point to the start of the rec_log</span>

            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">beyond_threshold</span><span class="p">:</span>
                <span class="n">timepoints_of_skips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">daq_time</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                <span class="n">timepoints_of_skips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">daq_time</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">timepoints_of_skips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">daq_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1">## specifying starts and stops from timepoint collection </span>
            <span class="n">start_values</span> <span class="o">=</span> <span class="n">timepoints_of_skips</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">stop_values</span> <span class="o">=</span> <span class="n">timepoints_of_skips</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">start_values</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start timepoints: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start_values</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stop timepoints: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stop_values</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There&#39;s not any skips in the movie frame playback that are bigger than </span><span class="si">{}</span><span class="s2"> frames.</span><span class="se">\n</span><span class="s2">The biggest skip is </span><span class="si">{}</span><span class="s2"> frames.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">threshold</span> <span class="o">/</span> <span class="mf">0.04</span><span class="p">),</span> <span class="p">(</span><span class="n">max_jump</span> <span class="o">/</span> <span class="mf">0.04</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">start_values</span> <span class="o">=</span> <span class="n">daq_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">stop_values</span> <span class="o">=</span> <span class="n">daq_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>


        <span class="k">return</span> <span class="n">start_values</span><span class="p">,</span> <span class="n">stop_values</span><span class="p">,</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="epiphyte.preprocessing.data_preprocessing.data_utils.TimeConversion.convert" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.TimeConversion.convert" class="headerlink" title="Permanent link">&para;</a></h5>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">convert</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute mapping and convert watchlog times to DAQ times.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[np.ndarray, np.ndarray, np.ndarray]: <code>(pts_seconds, dts_ms, cpu_time_us)</code> arrays.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute mapping and convert watchlog times to DAQ times.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[np.ndarray, np.ndarray, np.ndarray]: ``(pts_seconds, dts_ms, cpu_time_us)`` arrays.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">event_mat</span> <span class="o">=</span> <span class="n">process_events</span><span class="p">(</span><span class="n">nev_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_evts</span><span class="p">))</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">get_coeff</span><span class="p">(</span><span class="n">event_mat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_daqlog</span><span class="p">)</span>
    <span class="n">pts</span><span class="p">,</span> <span class="n">cpu_time</span> <span class="o">=</span> <span class="n">read_watchlog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_watchlog</span><span class="p">)</span>

    <span class="c1"># first convert cpu time to recording system time</span>
    <span class="n">daq_time</span> <span class="o">=</span> <span class="n">cpu_time</span> <span class="o">*</span> <span class="n">m</span> <span class="o">+</span> <span class="n">b</span>

    <span class="k">return</span> <span class="n">pts</span><span class="p">,</span> <span class="n">daq_time</span><span class="p">,</span> <span class="n">cpu_time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="epiphyte.preprocessing.data_preprocessing.data_utils.TimeConversion.convert_pauses" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_pauses</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.TimeConversion.convert_pauses" class="headerlink" title="Permanent link">&para;</a></h5>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">convert_pauses</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert pause CPU timestamps to neural recording time.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="float">float</span>], <span title="typing.List">List</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[List[float], List[float]]: <code>(starts_ms, stops_ms)</code> lists in neural recording time.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_pauses</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert pause CPU timestamps to neural recording time.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[float], List[float]]: ``(starts_ms, stops_ms)`` lists in neural recording time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">read_watchlog_pauses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_watchlog</span><span class="p">)</span>
    <span class="n">event_mat</span> <span class="o">=</span> <span class="n">process_events</span><span class="p">(</span><span class="n">nev_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_evts</span><span class="p">))</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">get_coeff</span><span class="p">(</span><span class="n">event_mat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_daqlog</span><span class="p">)</span>

    <span class="n">convert_start</span> <span class="o">=</span> <span class="p">[</span><span class="n">time</span> <span class="o">*</span> <span class="n">m</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">start</span><span class="p">)]</span>
    <span class="n">convert_stop</span> <span class="o">=</span> <span class="p">[</span><span class="n">time</span> <span class="o">*</span> <span class="n">m</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stop</span><span class="p">)]</span>

    <span class="c1">#### NOTE: depending on the output set-up, comment/uncomment. </span>
    <span class="c1">##### Generally, can use the highlights options on the interactive plot</span>
    <span class="c1">##### to indicate if time-scales are not coherent between the data and the </span>
    <span class="c1">##### pauses. </span>
    <span class="c1">#convert_start = make_msec(convert_start)</span>
    <span class="c1">#convert_stop = make_msec(convert_stop)</span>

    <span class="k">return</span> <span class="n">convert_start</span><span class="p">,</span> <span class="n">convert_stop</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="epiphyte.preprocessing.data_preprocessing.data_utils.TimeConversion.convert_skips" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_skips</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.TimeConversion.convert_skips" class="headerlink" title="Permanent link">&para;</a></h5>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">convert_skips</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Detect skips and return start/stop/value segments in DAQ time.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[np.ndarray, np.ndarray, np.ndarray]: <code>(start_values_ms, stop_values_ms, values_idx)</code> arrays.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_skips</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect skips and return start/stop/value segments in DAQ time.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[np.ndarray, np.ndarray, np.ndarray]: ``(start_values_ms, stop_values_ms, values_idx)`` arrays.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pts</span><span class="p">,</span> <span class="n">daq_time</span><span class="p">,</span> <span class="n">cpu_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>

    <span class="n">threshold</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">max_jump</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pts</span><span class="p">)))</span>


    <span class="k">if</span> <span class="n">max_jump</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is a skip in the movie frame playback that is bigger than </span><span class="si">{}</span><span class="s2"> frames.</span><span class="se">\n</span><span class="s2">The biggest skip is </span><span class="si">{}</span><span class="s2"> frames.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">threshold</span> <span class="o">/</span> <span class="mf">0.04</span><span class="p">),</span> <span class="p">(</span><span class="n">max_jump</span> <span class="o">/</span> <span class="mf">0.04</span><span class="p">)))</span>

        <span class="c1"># list of indices where the pts jumped by 25+ frames</span>
        <span class="n">beyond_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pts</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Timepoints of skips, in neural_rec_time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">daq_time</span><span class="p">[</span><span class="n">beyond_threshold</span><span class="p">]))</span>

        <span class="c1">## setting up start/stop values</span>
        <span class="n">timepoints_of_skips</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">timepoints_of_skips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">daq_time</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># set first start point to the start of the rec_log</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">beyond_threshold</span><span class="p">:</span>
            <span class="n">timepoints_of_skips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">daq_time</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">timepoints_of_skips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">daq_time</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">timepoints_of_skips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">daq_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1">## specifying starts and stops from timepoint collection </span>
        <span class="n">start_values</span> <span class="o">=</span> <span class="n">timepoints_of_skips</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">stop_values</span> <span class="o">=</span> <span class="n">timepoints_of_skips</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">start_values</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start timepoints: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start_values</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stop timepoints: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stop_values</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There&#39;s not any skips in the movie frame playback that are bigger than </span><span class="si">{}</span><span class="s2"> frames.</span><span class="se">\n</span><span class="s2">The biggest skip is </span><span class="si">{}</span><span class="s2"> frames.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">threshold</span> <span class="o">/</span> <span class="mf">0.04</span><span class="p">),</span> <span class="p">(</span><span class="n">max_jump</span> <span class="o">/</span> <span class="mf">0.04</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">start_values</span> <span class="o">=</span> <span class="n">daq_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">stop_values</span> <span class="o">=</span> <span class="n">daq_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">start_values</span><span class="p">,</span> <span class="n">stop_values</span><span class="p">,</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.data_utils.nev_read" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">nev_read</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.nev_read" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">nev_read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Read event timestamps and codes from <code>.nev</code> or mock <code>.npy</code> file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to <code>.nev</code> or mock <code>.npy</code> array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: <code>(timestamp, nttl)</code> array of shape <code>(N, 2)</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">nev_read</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read event timestamps and codes from ``.nev`` or mock ``.npy`` file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str | Path): Path to ``.nev`` or mock ``.npy`` array.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: ``(timestamp, nttl)`` array of shape ``(N, 2)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.nev&quot;</span><span class="p">:</span>
        <span class="n">eventmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">memmap</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">nev_type</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">NLX_OFFSET</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">eventmap</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">eventmap</span><span class="p">[</span><span class="s1">&#39;nttl&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
    <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.npy&quot;</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.data_utils.nev_string_read" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">nev_string_read</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.nev_string_read" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">nev_string_read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Read event timestamps and strings from a <code>.nev</code> file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to <code>.nev</code> file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: <code>(timestamp, ev_string)</code> array of shape <code>(N, 2)</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">nev_string_read</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read event timestamps and strings from a ``.nev`` file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str | Path): Path to ``.nev`` file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: ``(timestamp, ev_string)`` array of shape ``(N, 2)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eventmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">memmap</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">nev_type</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">NLX_OFFSET</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">eventmap</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">eventmap</span><span class="p">[</span><span class="s1">&#39;ev_string&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.data_utils.process_movie_events" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">process_movie_events</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.process_movie_events" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">process_movie_events</span><span class="p">(</span><span class="n">ev_array</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Filter raw event rows to the movie-event sequence.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ev_array</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>(timestamp, code)</code> array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    np.ndarray: Filtered movie event rows.</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_movie_events</span><span class="p">(</span><span class="n">ev_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter raw event rows to the movie-event sequence.</span>

<span class="sd">    Args:</span>
<span class="sd">        ev_array (np.ndarray): ``(timestamp, code)`` array.</span>
<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Filtered movie event rows.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">wait_for</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">keep</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ev_array</span><span class="p">:</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wait_for</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">elif</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">]:</span>
            <span class="n">wait_for</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">last</span> <span class="o">==</span> <span class="mi">128</span><span class="p">:</span>
                <span class="n">wait_for</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">last</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">]:</span>
                <span class="n">wait_for</span> <span class="o">=</span> <span class="p">[</span><span class="n">last</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span>

        <span class="n">last</span> <span class="o">=</span> <span class="n">code</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.data_utils.process_events" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">process_events</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.process_events" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">process_events</span><span class="p">(</span><span class="n">ev_array</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract movie-event rows from a full event array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ev_array</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Full event array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    np.ndarray: Movie-event subset.</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_events</span><span class="p">(</span><span class="n">ev_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract movie-event rows from a full event array.</span>

<span class="sd">    Args:</span>
<span class="sd">        ev_array (np.ndarray): Full event array.</span>
<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Movie-event subset.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ev_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="n">onsets</span> <span class="o">=</span> <span class="p">(</span><span class="n">ev_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">101</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n_101</span> <span class="o">=</span> <span class="n">onsets</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># use the first 8 as marker that screening is over</span>
        <span class="n">first_8</span> <span class="o">=</span> <span class="p">(</span><span class="n">ev_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># go back to last 4 before first 8</span>
        <span class="n">last_4</span> <span class="o">=</span> <span class="p">(</span><span class="n">ev_array</span><span class="p">[:</span><span class="n">first_8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># print(first_8, last_4)</span>

        <span class="k">assert</span> <span class="n">n_101</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

        <span class="n">movie_events</span> <span class="o">=</span> <span class="n">ev_array</span><span class="p">[</span><span class="n">last_4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">onsets</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="p">:]</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">process_movie_events</span><span class="p">(</span><span class="n">movie_events</span><span class="p">)</span>

    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ev_array</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ev_array</span>

    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.data_utils.getlines" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">getlines</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.getlines" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">getlines</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Read a text file and return the raw lines as bytes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="bytes">bytes</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[bytes]: List of lines (bytes).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getlines</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read a text file and return the raw lines as bytes.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str | Path): Path to file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[bytes]: List of lines (bytes).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">logfile</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">logfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.data_utils.read_watchlog" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">read_watchlog</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.read_watchlog" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">read_watchlog</span><span class="p">(</span><span class="n">watchlogfile</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract PTS (s) and CPU times (µs) from a watchlog.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>watchlogfile</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to watchlog created by ffmpeg wrapper.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[np.ndarray, np.ndarray]: Tuple <code>(pts_seconds, cpu_time_us)</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_watchlog</span><span class="p">(</span><span class="n">watchlogfile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract PTS (s) and CPU times (µs) from a watchlog.</span>

<span class="sd">    Args:</span>
<span class="sd">        watchlogfile (str | Path): Path to watchlog created by ffmpeg wrapper.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[np.ndarray, np.ndarray]: Tuple ``(pts_seconds, cpu_time_us)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">getlines</span><span class="p">(</span><span class="n">watchlogfile</span><span class="p">)</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">time</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">fields</span>  <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pts</span><span class="p">,</span> <span class="n">time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.data_utils.read_watchlog_pauses" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">read_watchlog_pauses</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.read_watchlog_pauses" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">read_watchlog_pauses</span><span class="p">(</span><span class="n">watchlogfile</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Find pause segments in the watchlog.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>watchlogfile</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to pts/CPU watchlog.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    Tuple[List[int], List[int]]: <code>(start_times_us, stop_times_us)</code> lists.</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_watchlog_pauses</span><span class="p">(</span><span class="n">watchlogfile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find pause segments in the watchlog.</span>

<span class="sd">    Args:</span>
<span class="sd">        watchlogfile (str | Path): Path to pts/CPU watchlog.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[int], List[int]]: ``(start_times_us, stop_times_us)`` lists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">getlines</span><span class="p">(</span><span class="n">watchlogfile</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stop_time</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">first</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># print(first)</span>
        <span class="k">if</span> <span class="s2">&quot;Pausing&quot;</span> <span class="ow">in</span> <span class="n">first</span><span class="p">:</span>
            <span class="c1"># print(line)</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">start_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>
            <span class="c1"># print(start_line)</span>
            <span class="n">start_fields</span> <span class="o">=</span> <span class="n">start_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">start_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start_fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

        <span class="k">if</span> <span class="s2">&quot;Continuing&quot;</span> <span class="ow">in</span> <span class="n">first</span><span class="p">:</span>
            <span class="c1"># print(line)</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">stop_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">stop_fields</span> <span class="o">=</span> <span class="n">stop_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">stop_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">stop_fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

        <span class="k">if</span> <span class="s2">&quot;Properly&quot;</span> <span class="ow">in</span> <span class="n">first</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">3</span>
            <span class="n">start_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>
            <span class="c1"># print(start_line)</span>
            <span class="n">start_fields</span> <span class="o">=</span> <span class="n">start_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">stop_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start_fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">stop_time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.data_utils.read_daqlog" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">read_daqlog</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.read_daqlog" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">read_daqlog</span><span class="p">(</span><span class="n">daqlogfile</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract DAQ values and pre/post times.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>daqlogfile</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to DAQ log file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[np.ndarray, np.ndarray, np.ndarray]: <code>(values, pretime_us, posttime_us)</code> arrays.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_daqlog</span><span class="p">(</span><span class="n">daqlogfile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract DAQ values and pre/post times.</span>

<span class="sd">    Args:</span>
<span class="sd">        daqlogfile (str | Path): Path to DAQ log file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[np.ndarray, np.ndarray, np.ndarray]: ``(values, pretime_us, posttime_us)`` arrays.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">getlines</span><span class="p">(</span><span class="n">daqlogfile</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pretime</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">posttime</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">pretime</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">posttime</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">pretime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pretime</span><span class="p">)</span>
    <span class="n">posttime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">posttime</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">values</span><span class="p">,</span> <span class="n">pretime</span><span class="p">,</span> <span class="n">posttime</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.data_utils.get_coeff" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_coeff</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.get_coeff" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_coeff</span><span class="p">(</span><span class="n">event_mat</span><span class="p">,</span> <span class="n">daqlogfile</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fit a linear mapping from DAQ post times to event timestamps.</p>
<p>Loads logs, validates events, and returns slope/intercept.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>event_mat</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>(timestamp, code)</code> event array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>daqlogfile</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to DAQ log file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    np.ndarray: <code>[m, b]</code> array such that <code>timestamp = m*post + b</code>.</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_coeff</span><span class="p">(</span><span class="n">event_mat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">daqlogfile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit a linear mapping from DAQ post times to event timestamps.</span>

<span class="sd">    Loads logs, validates events, and returns slope/intercept.</span>

<span class="sd">    Args:</span>
<span class="sd">        event_mat (np.ndarray): ``(timestamp, code)`` event array.</span>
<span class="sd">        daqlogfile (str | Path): Path to DAQ log file.</span>
<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: ``[m, b]`` array such that ``timestamp = m*post + b``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eventTimes</span><span class="p">,</span> <span class="n">eventValues</span> <span class="o">=</span> <span class="n">event_mat</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">event_mat</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">daqValues</span><span class="p">,</span> <span class="n">daqPretimes</span><span class="p">,</span> <span class="n">daqPosttimes</span> <span class="o">=</span> <span class="n">read_daqlog</span><span class="p">(</span><span class="n">daqlogfile</span><span class="p">)</span>

    <span class="c1"># check events:</span>
    <span class="n">EventErrors</span> <span class="o">=</span> <span class="p">(</span><span class="n">eventValues</span> <span class="o">!=</span> <span class="n">daqValues</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">EventErrors</span><span class="p">:</span>
        <span class="k">raise</span><span class="p">(</span><span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Events from 2 logs do not match, </span><span class="si">{}</span><span class="s1"> errors.&#39;</span><span class="o">.</span>
                      <span class="nb">format</span><span class="p">(</span><span class="n">EventErrors</span><span class="p">)))</span>

    <span class="c1"># check that daq is quick enough</span>
    <span class="n">diffs</span> <span class="o">=</span> <span class="n">daqPosttimes</span> <span class="o">-</span> <span class="n">daqPretimes</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min Daq Diff: </span><span class="si">{:.1f}</span><span class="s2"> ms, Max Daq Diff: </span><span class="si">{:.1f}</span><span class="s2"> ms&quot;</span><span class="o">.</span>
          <span class="nb">format</span><span class="p">(</span><span class="n">diffs</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">diffs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e3</span><span class="p">))</span>

    <span class="c1"># convert daqPosttimes to eventTimes by polyfit, check error</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">daqPosttimes</span><span class="p">,</span> <span class="n">eventTimes</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">fitdaq</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">daqPosttimes</span> <span class="o">+</span> <span class="n">b</span>
    <span class="n">maxFitError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fitdaq</span><span class="o">-</span><span class="n">eventTimes</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e3</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Maximum Error after Event fit: </span><span class="si">{:.1f}</span><span class="s2"> ms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maxFitError</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="epiphyte.preprocessing.data_preprocessing.data_utils.make_msec" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">make_msec</span>


<a href="#epiphyte.preprocessing.data_preprocessing.data_utils.make_msec" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">make_msec</span><span class="p">(</span><span class="n">list_usec</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert a list from microseconds to milliseconds.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>list_usec</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Times in microseconds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    list[float]: Times in milliseconds.</p>


            <details class="quote">
              <summary>Source code in <code>epiphyte/preprocessing/data_preprocessing/data_utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_msec</span><span class="p">(</span><span class="n">list_usec</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a list from microseconds to milliseconds.</span>

<span class="sd">    Args:</span>
<span class="sd">        list_usec (list[int]): Times in microseconds.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list[float]: Times in milliseconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">list_msec</span> <span class="o">=</span> <span class="p">[</span><span class="n">time</span> <span class="o">/</span> <span class="mi">1000</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_usec</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">list_msec</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.instant", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>